<!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- $Id: Start.html,v 1.2 2004-09-02 17:02:47 jacobsen Exp $ -->
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Bob Jacobsen, LBL">
   <meta name="GENERATOR" content="Mozilla/4.75C-CCK-MCD {C-UDP; EBM-APPLE} (Macintosh; U; PPC) [Netscape]">
   <meta name="Content-Type" content="text/html; charset=iso-8859-1">
   <title>Getting Started with JMRI Scripting</title>
</head>
<body>

<A href="../index.html">
<IMG SRC="../images/logo.gif" ALIGN=RIGHT WIDTH="160" HEIGHT="135" HSPACE="0" VSPACE="0">
</a>

<h1>Getting Started with JMRI Scripting</h1>


<pre>

>>> turnouts.newTurnout("LT1", "")
jmri.jmrix.loconet.LnTurnout@1a8f49

>>> turnouts.getTurnout("LT1").getCommandedState()
1

>>> lt1 = turnouts.getTurnout("LT1")

>>> lt1.setCommandedState(CLOSED)

>>> lt1.commandedState
2

>>> lt1.commandedState = THROWN

>>> lt1.commandedState
4

>>> 
</PRE>

Note that this is running a complete version of the JmriDemo application;
all of the windows and menus are presented the same way, configuration is
done by the preferences panel, etc. What the Jython connection adds is a 
command line from which you can directly manipulate things.

<BR/>This also shows some of the simplifications that
Jython and the Python language brings to using JMRI code.  The
Java member function:
<PRE>
	turnout.SetCommandedState(jmri.Turnout.CLOSED);
</PRE>
can also be expressed in Jython as:
<PRE>
	turnout.commandedState = CLOSED
</PRE>
<BR/>
This results in much easier-to-read code.
<P>
There are a lot of useful Python books and 
online tutorials.
For more information on the Jython language and it's 
relations with Java, the best reference is the
<A HREF="http://www.oreilly.com/catalog/jythoness/">Jython Essentials</a>
book published by O'Reilly.  The 
<A HREF="http://www.jython.org/">jython.org web site</a> is also very useful.


<h3>Access to JMRI</h3>

JMRI uses the factory-pattern extensively to get access to 
objects.  In Java this results in verbose code like
<PRE>
   Turnout t2 = InstanceManager.turnoutManagerInstance().newTurnout("LT2", "turnout 2");
   t2.SetCommandedState(Turnout.THROWN)
</PRE>
Jython simplifies that by allowing us to provide useful variables,
and by shortening certain method calls.
<P>
To get access to the SignalHead, Sensor and Turnout managers and
the CommandStation object,
several shortcut variables are defined in the .py scripts listed above:
<UL>
<LI>sensors
<LI>signals
<LI>turnouts
<LI>reporters
<LI>memories
<LI>dcc
</UL>
These can then be referenced directly in Jython as
<PRE>
   t2 = turnouts.provideTurnout("12");
   
   dcc.
</PRE>
Note that the variable t2 did not need to be declared.
<P>
Jython provides a shortcut for parameters that have 
been defined with Java-Bean-like get and set methods:
<PRE>
   t2.SetCommandedState(Turnout.THROWN)
</PRE>
can be written as
<PRE>
   t2.commandedState = THROWN
</PRE>
where the assignment is actually invoking the set method.
Also note that THROWN was defined when running the Python script
at startup; CLOSED, ACTIVE, INACTIVE, RED, YELLOW and GREEN are
also defined.
<P>
A similar mechanism can be used to check the state of something:
<PRE>
>>> print sensors.provideSensor("3").knownState == ACTIVE 
1
>>> print sensors.provideSensor("3").knownState == INACTIVE
0
</PRE>
Note that Jython uses "1" to indicate true, and "0" to indicate
false, so sensor 3 is currently active in this example
<P>
You can also directly invoke methods, e.g. to send a DCC
packet to the rails you type:
<PRE>   
   dcc.sendPacket([0x01, 0x03, 0xbb], 4) 
</PRE>
This sends that three-byte packet four times, and then returns to the
command line.
<P>
To exit, either ^C from the command line, or use the exit
command from the menu.  

<H2>Using Python for signal logic and automation</h2>

The existing JMRI 
"<A HREF="../Automat.html">Automat</a>"
classes provide hooks for user layout automation, including signaling.
But they require that you write Java code and compile it into .class files.
<P>
The 
<A HREF="doc/jmri/jmrit/automat/JythonAutomaton.html">JythonAutomaton</a>
class is intended to make it easier to code custom layout automation, as
it will allow you to invoke a Jython script.  Once it's integrated into
the configuration process, you'll be able to code your automation in one
or more .py files, and have the program start running them at startup.

<HR>
<BR>Site hosted by: <BR>
<A href="http://sourceforge.net"> 
<IMG src="http://sourceforge.net/sflogo.php?group_id=26788&type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 

<hr>
Bob Jacobsen<BR>
jake@physics.berkeley.edu

</body>
</html>
