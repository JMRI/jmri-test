<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: ex_set_turnouts.html,v 1.2 2006-03-23 15:28:19 jacobsen Exp $ -->
<html lang="en">
<head>
  <TITLE>
 	JMRI: Scripting Examples
  </TITLE>
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">

  <META content="Bob Jacobsen" name=Author>

  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <meta name="keywords"
        content="scripting jython python panelpro example examples">

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
  <div id="container">
    <p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>

<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/logo-jmri.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->



	  <hr class="hide">
	  <div id="mBody">
	  <div id="side"> <!-- Block of text on left side of page -->
	    <dl>

		<dt><h3><a href="index.html">Scripting</a></h3></dt>
		<dd>Information on writing scripts to control JMRI in more detail:
		    <UL>
		    <LI><dfn><a href="Start.html">Introduction</a></dfn>
		    <LI><dfn><A HREF="Python.html">The Language</a></dfn>
		    <LI><dfn><a href="Examples.html">Examples</a></dfn>
		    <LI><dfn><a href="FAQ.html">Frequently Asked Questions (FAQs)</a></dfn>
		    </UL>
		</dd>

		<dt><h3><a href="http://www.python.org">Python</a></h3></dt>
		<dd>JMRI scripts are in Python, a popular general-purpose computer language
		    <UL>
		    <LI><dfn><a href="Python.html">Python & JMRI</a></dfn>
		    <LI><dfn><a href="http://www.python.org">Python home page</a></dfn>
		    <LI><dfn><a href="http://wiki.python.org/moin/BeginnersGuide/NonProgrammers">Python tutorial for non-programmers</a></dfn>
		    <LI><dfn><a href="http://wiki.python.org/moin/BeginnersGuide/Programmers">Python tutorial for programmers</a></dfn>
		    </UL>
		</dd>

	    </dl>

<a href="http://sourceforge.net/donate/index.php?group_id=26788"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" ALIGN="RIGHT" alt="Support This Project" /> </a> 

	</div> <!-- closes #side -->



    <hr class="hide">

      <div id="mainContent">
      <!-- Page Body -->
        <H2>
		JMRI: Scripts To Go...<br>Setting the Default State of Turnouts
        </H2>

		<div class=section>


		    <P>(Example contributed by Jerry Britton)
		    
		    <p>My layout, the <a href="http://kc.pennsyrr.com/layout/" target=new>Pennsylvania Railroad Eastern Region</a>, already features over a hundred turnouts, with many more to come. At this time, and for the foreseeable future, the turnouts do not provide feedback; it's an expense I am not ready to incur.
			<p>I've developed <a href="http://kc.pennsyrr.com/layout/control_panels.ws4d" target=new>PanelPro panels</a> for a pair of dispatchers to use to control the railroad. PanelPro issues turnout commands via LocoNet (Digitrax system). Turnouts are powered by Tortoise switch machines which are controlled by NCE SwitchIt stationary decoders which monitor LocoNet for commands.
			<p>The problem is, without detection on the turnouts themselves, every time PanelPro is opened for the first time, all of the turnouts show a "?" state, meaning PanelPro doesn't know their current state.</p>
			<p>Until now, I've invested a considerable amount of time to manually click on each and every turnout to set its state -- any state -- then set it to the desired state. I've suggested that a default state field be added to the Turnout Table -- and maybe we'll see that in the future -- but for now my need may be met via a script. Perhaps you'll have a need it can meet as well.</p>
			<p>The reason for this web page is that I am a model railroader that uses JMRI. Our very talented programming team is made up of programmers that are also model railroaders. When I asked "How do I...", I received far more information than I needed or desired. I have no interest in becoming a programmer or learning exactly how it "works". I just have a need that I would like to be met with a minimal amount of effort. It was a classic example of asking for the time and being instructed how to build a watch!</p>
			<p>So here it is, a down and dirty script that you can copy, make simple edits for your own use, and start using immediately -- without having to know "how" it works.</p>
		</div>

		<div class=section>
		    <h2>The Script</h2>
		    
		    <pre>
class setStartup(jmri.jmrit.automat.AbstractAutomaton) :
   def init(self):
     return
   def handle(self):
     self.waitMsec(10000)         # time is in milliseconds
     turnouts.provideTurnout("1").setState(CLOSED)
     self.waitMsec(1000)
     turnouts.provideTurnout("17").setState(CLOSED)
     self.waitMsec(1000)
     turnouts.provideTurnout("9").setState(CLOSED)
     self.waitMsec(1000)
     return False              # all done, don't repeat again
setStartup().start()          # create one of these, and start it running		    </pre>

		</div>

		<div class=section>
		    <h2>Making Use of the Script</h2>
		    
			<p>You should "copy" and "paste" the sample script into a new text document. Be sure the file is indeed saved as a generic text document, and not something like a Microsoft Word file. The file suffix should be ".py" for Python, the command language used by JMRI.
			<p>Save the file where JMRI can access it. I save mine in the same directory as my PanelPro files.
			<p>It is VERY IMPORTANT that you keep the formatting of the script the way it is -- with leading tabs. The Python language uses tabs as part of its command structure.
		    <p>This first part of the script you should include "as is". No changes are necessary:</p>
		    
		    <pre>
class setStartup(jmri.jmrit.automat.AbstractAutomaton) :
   def init(self):
     return
   def handle(self):
     self.waitMsec(10000)         # time is in milliseconds
</pre>
		    
		    <p>The following part of the script is what you need to modify for your own use. Below are commands to set the state for three turnouts; each consists of two lines. 
			<p>The first line includes a number in quotations which is the turnout number (decoder ID) that you wish to send the command to. The state in parenthesis at the end of the line (CLOSED or THROWN) is the position you want the turnout set to. 
			<p>The second line adds a delay between commands, in milliseconds. If you have a lot of turnouts to set, your power supply would likely not be able to handle throwing them all at once. The delay allows the activations to be spread out over time. Dozens of turnouts may be set over a period of a minute or two.</p>
			<p>So "paste" multiple instances of the two line commands into your script as desired. You may also add comment lines (beginning with a "#") to document sections of your layout.</p>
		    <pre>
     turnouts.provideTurnout("1").setState(CLOSED)
     self.waitMsec(1000)
     turnouts.provideTurnout("17").setState(CLOSED)
     self.waitMsec(1000)
     turnouts.provideTurnout("9").setState(CLOSED)
     self.waitMsec(1000)
</pre>
		    
		    <p>The closing part of the script should also be left "as is":
		    <pre>
     return False              # all done, don't repeat again
setStartup().start()          # create one of these, and start it running		    </pre>

		</div>

		<div class=section>
		    <h2>Implementing the Script</h2>

		    
			<p>With track power on, you can execute the script by selecting Run Script from the PanelPro menu of JMRI. There will be a delay before script execution begins, but then you will see your turnouts throwing one by one.
			<p>You can also select the script to run automatically when PanelPro is launched by selecting the script file in Advanced Preferences. Be sure track power is on before launching PanelPro in this case.


		</div>

		<div class=section>
		    <h2>Credit Where Credit Is Due</h2>
    
			<p>My unending praise goes to the many developers who provide JMRI to the model railroad community. However, in the case of meeting my need in setting the default state of turnouts, I wish to extend my gratitude to  "breezlys" of the JMRI Forum community; he provided the sample script, which I believe he interpreted and modified from JMRI's sample scripts.
			<p>-- Page authored by Jerry Britton, March 2006.


		</div>

</div>

<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 1997 - 2006 JMRI Community. 
	<P>JMRI, DecoderPro, PanelPro, DispatcherPro and associated logos are our trademarks.
	<P><A href="/Copyright.html">Additional information on copyright, trademarks and licenses is linked here.</a></p>
    
       <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

      </div><!-- closes #mainContent-->
    </div> <!-- closes #mBody-->
  </div> <!-- closes #container -->
</body>
</html>



