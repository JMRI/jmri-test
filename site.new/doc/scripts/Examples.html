<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: Examples.html,v 1.6 2004-12-31 20:28:10 jacobsen Exp $ -->
<html lang="en">
<head>
    <TITLE>
 	JMRI: Scripting Examples
    </TITLE>
    <META content="Bob Jacobsen" name=Author>
    <meta name="keywords" content="JMRI decoderpro dcc script scripts scripting examples Jython">

    <!-- The combination of "Define" and {Header,Style, Logo and Footer} comments -->
    <!-- are an arbitrary design pattern used by the update.pl script to -->
    <!-- easily replace the common header/footer code for all the web pages -->

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
    <p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>

<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/logo-jmri.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->

    <hr class="hide">

    <div class="nomenu" id="mBody">
	<div id="mainContent">
	    <!-- ------------- -->
	    <!-- Page Contents --> <!-- Required -->
	    <!-- ------------- -->

	    <H1>JMRI: Scripting Examples</H1>
		<p class=subtitle>
		    Examples of JMRI scripting using Jython.
		</p>


		<div class=section>

		    <div class=para>
		    
		    <p>The JMRI distributions come with a "jython" directory
		    that contains a few examples.  As of the time of writing (Summer 2004)
		    these are:</p>
		    <dl>
		    <dt>AutomatonExample.py<dd>A simple automation example,
		    this runs a train back and forth between two blocks.
		    <dt>SigletExample.py<dd>An example of driving a signal from a script.
		    <dt>JButtonExample.py<dd>This is an example of adding an object to 
		    the GUI, in this case a button.  When clicked, it doesn't really
		    do anything except print a message, but it is an example after all!
		    <dt>ListenerExample.py<dd>Example of listing to a Turnout so that
		    the script can do something every time the Turnout's state changes.
		    </dl>
		    </div>

			<p>The rest of this page contains examples of specific techniques.
		</div>

		<div class=section>
		    <h2>Invoking another script file from a script</h2>

		    <div class=para>
		    
		    <pre>
execfile("filename.py");
		    </pre>
		    </div>

		</div>

		<div class=section>
		    <h2>Loading a panel file from within a script</h2>

		    <div class=para>
		    
		    <pre>
InstanceManager.configureManagerInstance().load(new File("filename.xml"));
		    </pre>
		    </div>

		</div>

		<div class=section>
		    <h2>Communicating between scripts</h2>

		    <div class=para>
		    All scripts share a single address space, which 
		    means that a variable like "x" refers to the same
		    location in all scripts.  This allows you to 
		    define a procedure, for example, in one script, and
		    use it elsewhere.  For example, if a "definitions.py"
		    file contained:
		    <pre>
def printStatus() :
  print "x is", x
  print "y is", y
  print "z is", z
  return

x = 0
y = 0
z = 0
		    </pre>

            Once that file has been executed, any later script can
            invoke the <code>printStatus()</code> routine whenever needed.
    	    </div>

		    <div class=para>
            You can also share variables, which allows two routines to 
            share information.  In the example above, the <code>x</code>,
            <code>y</code>, and <code>z</code> variables are available to
            anybody.
            This can lead to obscure bugs if two different routines 
            are using a variable of the same name, without realizing that
            they are sharing data with each other.  Putting your code
            into "classes" is a way to avoid that.
    	    </div>

		</div>

		<div class=section>
		    <h2>Can a script wait for more than one thing to change?</h2>

		    <div class=para>
            If your script is based on a Siglet or AbstractAutomaton
            class (e.g. if you're writing a "handle" routine", there's
            a general "waitChange" routine which waits for any of 
            several sensors to change before returning to you. Note that more 
            than one may change at the same time, so you can't assume that just 
            one has a different value! And you'll then have to check whether 
            they've become some particular state.  It's written as:

<PRE>
    self.waitChange([self.sensorA, self.sensorB, self.sensorC])
</PRE>
            where you've previously defined each of those "self.sensorA" things 
            via a line like:
<PRE>
    self.sensorA = sensors.provideSensor("21")
</PRE>
            You can then check for various combinations like:
<PRE>
   if self.sensorA.knownState == ACTIVE :
	print "The plane! The plane!"
   elif self.sensorB.knownState == INACTIVE :
	print "Would you believe a really fast bird?"
   else
	print "Nothing to see here, move along..."
</PRE>

        (I haven't actually typed these into a script & run it, so there 
        might be typos, sorry)


    	    </div>

		</div>

		<div class=section>
		    <h2>Listening to more than one Turnout</h2>

		    <div class=para>
		    JMRI objects (Turnouts, Sensors, etc) can have
		    "Listeners" attached to them. These are then notified
		    when the status of the object changes.
		    If you're using the Automat or Siglet classes, you
		    don't need to use this capability; those classes handle
		    all the creationg and registering of listeners.
		    But if you want to do something special, you may need
		    to use that capability.
		    <P>
			A single routine can listen to more than one
			Turnout, Sensor, etc.
			<P>
			If you retain a reference to your listener object, you
			can attach it to more than one object:
			<pre>
m = MyListener()
turnouts.provideTurnout("12").addPropertyChangeListener(m)
turnouts.provideTurnout("13").addPropertyChangeListener(m)
turnouts.provideTurnout("14").addPropertyChangeListener(m)
			</pre>
			<p>
			But how does the listener know what changed?
			<P>
			A listener routine looks like this:
			<pre>
class MyListener(java.beans.PropertyChangeListener):
  def propertyChange(self, event):
    print "change",event.propertyName
    print "from", event.oldValue, "to", event.newValue
    print "source systemName", event.source.systemName
    print "source userName", event.source.userName
			</pre>
			<P>
			When the listener is called, it's given an object
			(called event above) that contains the name of the
			property that changed, plus the old and
			new values of that property. 
			<P>
			You can also get a 
			reference to the original object that
			changed via "name", and then do whatever you'd like
			through that.  In the example above, you can
			retrieve the systemName, userName (or even other types
			of status).
			
		    </div>

		</div>

<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 1997 - 2004 JMRI Community. 
	<P>JMRI, DecoderPro, PanelPro, DispatcherPro and associated logos are our trademarks.
	<P><A href="/Copyright.html">Additional information on copyright, trademarks and licenses is linked here.</a></p>
    
       <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

	  </div><!-- closes #mainContent-->
	</div> <!-- closes #mBody-->
</body>
</html>

