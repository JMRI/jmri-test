<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <TITLE>
 	JMRI: Adding A New Data Type
    </TITLE>
    <META content="Bob Jacoben" name=Author>
    <meta name="keywords" content="JMRI technical type add">

    <!-- The combination of "Define" and {Header,Style, Logo and Footer} comments -->
    <!-- are an arbitrary design pattern used by the update.pl script to -->
    <!-- easily replace the common header/footer code for all the web pages -->

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
    <p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>

<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/logo-jmri.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->

    <hr class="hide">

    <div class="nomenu" id="mBody">
	<div id="mainContent">
	    <!-- ------------- -->
	    <!-- Page Contents --> <!-- Required -->
	    <!-- ------------- -->

	    <H1>JMRI: Adding A New Data Type</H1>

		<div class=para>
		<p>This page describes the steps to add a new data-type,
		e.g. Turnouts, to JMRI. </P>
		
		<p>It uses as an example the addition
		of the Reporter type in July, 2004. Reporter is a new
		type of NamedBean used to bring complex information
		back from the layout.</p>
		</div>

		<div class=list>
		<p>We list the files that are modified and created in the 
		order they were done in this case; other orders may also work,
		and you might not need to do all these.</p>
		<P>
		In this particular case, our first implementation is for
		only one hardware system (LocoNet).  This effects how
		we ordered this, and reduced the need to have unit tests
		in place at the beginning.  By working through the LocoNet
		implementation first, we could get a better idea of whether
		the proposed Reporter interface did what's needed.
		If you are creating a new type that several system will 
		need at first, you should also create unit tests early in the
		process to encode what you think is the common behavior.
		
		<P>In general, the new classes and interfaces defined below
		can most easily be made by copying an existing one.  In this
		case, we copy the "*Turnout*" file to make a corresponding
		"*Reporter*" file.
		<dl>

		<h3>Define the new type and it's manager</h3>

		    <dt class="left">Reporter</dt>
		    <dd class=first>
			<p>This interface defines the properties needed.
			It should inherit from NamedBean, though you can
			add new accessors as desired.</p>
		    </dd>

		    <dt class="left">ReporterManager</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <P>At this point, make sure you can compile.</P>

		    <dt class="left">doc/Technical/Names.html</dt>
		    <dd class=first>
			<p>Update the discussion of naming to include the
			type-letter for your new type.  While you're
			at it, update the system-specific naming pages as needed.</p>
		    </dd>

		<h3>Provide the base for implementations</h3>

		    <dt class="left">AbstractReporter</dt>
		    <dd class=first>
			<p>This is a basic implementation.  Provide
			basic internal functions so that</p>
		    </dd>
		    
		    <dt class="left">AbstractReporterManager</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <P>At this point, make sure you can compile.</P>

		    <dt class="left">managers.ProxyReporterManager</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <dt class="left">InstanceManager</dt>
		    <dd class=first>
			<p>There are several historical ways to install
			things in the InstanceManager.  The current way is
			to use "proxies" to allow the use of multiple layout
			systems, so please copy Turnout as a template.</p>
		    </dd>

		    <P>At this point, make sure you can compile.</P>

		<h3>Provide the first system-specific implementation</h3>

		    <dt class="left">jmrix.loconet/LnReporterManager</dt>
		    <dd class=first>
			<p>This class listens for activity indicating a 
			new LocoNet-specific Reporter, and calls for one to
			be created if needed.  Other than that, and providing
			the right system-specific letter (e.g. 'L'), this is
			just a direct copy.</p>
		    </dd>

		    <dt class="left">jmrix.loconet/LnReporter</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <P>At this point, make sure you can compile.
		    Nothing will happen when you run until the next step.</P>

		    <dt class="left">jmrix.loconet.LnPortController</dt>
		    <dd class=first>
			<p>Here (or perhaps somewhere else in another system) you
			create an instance of the correct ReporterManager class
			and install it in the InstanceManager.</p>
		    </dd>

		<h3>Add to the scripting support</h3>

		    <dt class="left">jython/jmri_defaults.py</dt>
		    <dd class=first>
			<p>Add a new variable to give easy access to the new manager.</p>
		    </dd>

		    <dt class="left">doc/Technical/Jython.html </dt>
		    <dd class=first>
			<p>Update this to refer to the new Jython variable 
			(There may be other web pages too!)</p>
		    </dd>

		    <P>At this point, you should be able to compile and 
		    run, testing the new code from the jython command line.</P>

		<h3>Add a new table tool for access (optional)</h3>
		
			<dt class="left">jmrit.beantable.ReporterTableAction</dt>
		    <dd class=first>
			<p>Create a new "Table" for watching these in action.</P>
			<p>In this particular case, the code had to be modified a little
			(instead of just copied) because a Reporter doesn't really
			have a way to support "click to change"</p>
		    </dd>

		    <dt class="left">jmrit/beantable/BeanTableBundle.properties</dt>
		    <dd class=first>
			<p>Add strings for the new properties you defined
			in the previous step.  You might also want to translate these
			in the other properties files when possible.</p>
		    </dd>

		    <dt class="left">jmrit.ToolsMenu</dt>
		    <dd class=first>
			<p>Add the new ReporterTableAction class to the menu.</p>
		    </dd>

		    <dt class="left">jmrit/JmritToolsBundle.properties</dt>
		    <dd class=first>
			<p>Add strings for the new property you defined
			in the previous step.  You might also want to translate these
			in the other properties files when possible.</p>
		    </dd>

		    <P>At this point, you should be able to compile and 
		    run to test the new table.</P>

		<h3>Provide for persistance of the manager and type objects</h3>

		    <dt class="left">configxml.AbstractReporterManagerConfigXML</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <dt class="left">jmrix.loconet.configurexml.LnReporterManagerXml</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>
		    
		    <dt class="left">xml/DTD/layout-config.dtd</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		<h3>Provide a suitable display icon class (optional)</h3>

		    <dt class="left">jmrit.display.ReporterIcon</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <dt class="left">jmrit.display.configxml.ReporterIconXml</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <dt class="left">xml/DTD/layout-config.dtd</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		    <dt class="left">Topic</dt>
		    <dd class=first>
			<p>discussion</p>
		    </dd>

		<h3>Complete the documentation</h3>

		    <dt class="left">ant javadoc</dt>
		    <dd class=first>
			<p>Create the JavaDocs, and fix any new (or old) problems.</p>
		    </dd>

		</dl>
		</div>

<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 2003,2004 JMRI Community</p>
        <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

	  </div><!-- closes #mainContent-->
	</div> <!-- closes #mBody-->
</body>
</html>

