<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: ColorTrack.html,v 1.3 2007-11-22 19:47:27 jacobsen Exp $ -->
<html lang="en">

<head>
    <TITLE>
JMRI: Displaying Colored Trackwork
    </TITLE>
    <META content="Bob Jacobsen" name=Author>
    <META name="keywords"
          content="java model railroad JMRI panelpro colored track">

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
    <div id="container">
    <p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/logo-jmri.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->


<!-- start PanelPro side bar -->
	  <hr class="hide">
	  <div id="mBody">
	  <div id="side"> <!-- Block of text on left side of page -->
	    <dl>
		<dt><h3><a href="FAQ.html">FAQ</a></h3></dt>
		<dd>
		    Frequently asked questions about PanelPro and their answers
		</dd>

		<dt><h3>Useful References</h3></dt>
		<dd>
		    <UL>
		    <LI><A HREF="/apps/Signalling/">Signals</a>
		    <LI><A HREF="../../../tools/Routes.html">Routes</a>
		    <LI><A HREF="../../../tools/fastclock">Fast Clocks</a>
		    <LI><A HREF="AdvIcons.html">Advanced Icons</a>
		    <LI><A HREF="../../doc/Technical/TurnoutFeedback.html">Turnout Feedback</a>
		    </UL>
		</dd>

	    </dl>

<a href="http://sourceforge.net/donate/index.php?group_id=26788"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" ALIGN="RIGHT" alt="Support This Project" /> </a> 

<!-- end PanelPro side bar -->

	</div> <!-- closes #side -->
	<hr class="hide">	<!-- only shows up on printouts -->
	<div id="mainContent">	<!-- Body of page -->

		<h1>JMRI: Displaying Colored Trackwork</h1>

People who model modern railroad might want a control panel
that shows a "schematic" view of the railroad, with individual
segments changing color to show where trains are occupying the track.
PanelPro can do this for your panels.  There are two basic approaches:

<UL>
<LI>Use the new
"<a href="/help/en/package/jmri/jmrit/display/LayoutEditor.html">Layout Editor</a>" 
to create your panel. It allows you
to 
<a href="/help/en/package/jmri/jmrit/display/EditTrackSegment.html">draw track segments</a>
and 
<a href="/help/en/package/jmri/jmrit/display/EditLayoutTurnout.html">place turnouts</a>
on the screen, then configure them so they 
<a href="/help/en/package/jmri/jmrit/display/EditLayoutBlock.html">change color with occupancy</a>.

<LI>If using the original "Panel Editor", you can also configure sensor icons
to change the color of your track.  This technique is described on this page.
</UL>

<H3>Background</h3>

PanelPro detects the status of things on the layout, including whether
a track is occupied, using "Sensors".  Depending on what hardware (DCC system, etc)
you have on your layout, these might be different devices, but as far
as the program cares they all basically work the same:  The tell the program
that the block detector is in one of four states:
<UL>
<LI>INACTIVE - The segment of track is empty
<LI>ACTIVE - The segment of track contains all or part of a train
<LI>UNKNOWN - The program does not currently know the status of this Sensor, typically
because the program has just started up and hasn't seen a message from it yet
<LI>INCONSISTENT - Some error has happened, and rather than giving you a value that might 
be wrong, we're just saying that we're confused
</UL>

For a particular "SensorIcon" at some spot on the screen, PanelPro associates
a different picture with each of these states.  When the state changes, the
correct picture is placed on the screen.
<P>
So the basic problem is getting the correct pictures to put on the screen.

<H3>Step-by-Step Instructions</h3>

<OL>
<LI>
Draw the basic bacground for your panel, including the trackwork.  Get the
colors, positions, etc right, because going back to it later will require redoing
a couple of steps.
<br>
<IMG src="images/WhiteTrack.gif">
<LI>

Take your favorite paint program and cut out the little pieces of the image that
correspond to blocks.  If you've got mutiple blocks of the exact same
shape and size, you don't have to make separate copies of them.
<br>
<IMG src="images/WhiteArc.gif">
<IMG src="images/WhiteLine.gif">
<IMG src="images/WhiteTO.gif">

<LI>
You'll use those to make colored images to show occupancy.  For example, if
you want to have yellow indicate occupied track, white indicate unoccupied
track, and red indicate errors, you need to copy those new images and create versions
with the appropriate colors. (Note: Make sure to keep a copy of the original
little image for any track segments that contains a turnout)
<BR>
<IMG src="images/YellowArc.gif">
<IMG src="images/RedArc.gif">
<IMG src="images/WhiteArc.gif">
<lI>
Now create the panel using these images, as described in the 
<A HREF="PanelPro.html">tutorials</a>.

</OL>

For turnouts, the situation is a little more complicated. Most people
want to represent <i>both</i> the occupancy <i>and</i> the position of the turnout.
We need a couple more steps to do that.

<OL>

<LI>
Create sensor images for the trackwork as described above.
<BR>
<IMG src="images/YellowTO.gif">
<IMG src="images/RedTO.gif">
<IMG src="images/WhiteTO.gif">
<LI>
Now, we create images that will modify those to show the turnout
position.  We want to create images that are transparent where
the trackwork is, except for a little more background color to 
represent the position of the turnout.
<BR>
<IMG src="images/TranTOc.gif">
<IMG src="images/TranTOt.gif">
<BR>
Here the gray color represents transparent parts of the image; if we put
it over one of the sensor images, the sensor's track color will shine 
through.

<lI>
Now create the panel using these images, as described in the 
<A HREF="PanelPro.html">tutorials</a>. The normal operation
(which we'll change below) is to have sensors in front of turnouts
on the screen.  That means it'll be easier if you add and position
the turnout icons first, then the sensor icons.

<LI>
To move the sensor icons behind the turnout icons, you have
to edit the panel file and change their "level".  Open your file
in a text editor (Not Microsoft Word, which will try to interpret
the XML and do amazingly stupid things).

<LI>
Find the lines for your sensor and turnout by looking for the name of the
sensor and turnout, e.g. LS33 and LT120.  You find two lines (which may be
separated, depending on how you created the panel) that look like this:

<PRE>
    &lt;turnouticon turnout="LT120" x="20" y="30" level="7" closed="resources/icons/smallschematics/tracksegments/os-righthand-west-closed.gif" thrown="resources/icons/smallschematics/tracksegments/os-righthand-west-thrown.gif" unknown="resources/icons/smallschematics/tracksegments/os-righthand-west-unknown.gif" inconsistent="resources/icons/smallschematics/tracksegments/os-righthand-west-error.gif" rotate="0" forcecontroloff="false" class="jmri.jmrit.display.configurexml.TurnoutIconXml" /&gt;
    &lt;sensoricon sensor="LS33" x="20" y="30" level="10" active="resources/icons/smallschematics/tracksegments/circuit-occupied.gif" inactive="resources/icons/smallschematics/tracksegments/circuit-empty.gif" unknown="resources/icons/smallschematics/tracksegments/circuit-error.gif" inconsistent="resources/icons/smallschematics/tracksegments/circuit-error.gif" rotate="0" forcecontroloff="false" momentary="false" class="jmri.jmrit.display.configurexml.SensorIconXml" /&gt;
</PRE>

Note the "level" attribures that are set to 7 aand 10 respectively.  
(Higher numbers are more toward the "front", and hide things with "lower" values.)
Just swap those values, and save the file.
</OL>


Since you cut
the little images from your track diagram, it should all go back together
seamlessly on the screen.
<P>
Now that panel should show icons for the occupancy sensor and turnout
that work independently to show both the position (by following the line)
and the occupancy (through the color) of that turnout.  



<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 2004 - 2007 JMRI Community. 
	<P>JMRI, DecoderPro, PanelPro, DispatcherPro and associated logos are our trademarks.
	<P><A href="/Copyright.html">Additional information on copyright, trademarks and licenses is linked here.</a></p>
    
       <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

	    <script type="text/javascript" 
		src="http://ss.webring.com/navbar?f=j;y=bob_jacobsen15;u=100088115910095949">
		</script><noscript><center>
		<table bgcolor=gray cellspacing=0 border=2 bordercolor=red><tr>
		<td><table cellpadding=2 cellspacing=0 border=0><tr><td align=center>
		<font face=arial size=-1>This site is a member of WebRing. 
		<br>To browse visit <a href="http://ss.webring.com/navbar?f=l;y=bob_jacobsen15;u=100088115910095949">
		Here</a>.</font></td></tr></table></td></tr></table>
		</center></noscript>

	</div> <!-- closes #mainContent-->
    </div> <!-- closes #mBody-->
</div> <!-- closes #container -->
</body>
</html>


