<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: CreateDecoder.html,v 1.9 2004-08-08 01:56:13 jacobsen Exp $ -->
<html lang="en">
<head>
    <TITLE>
	JMRI: DecoderPro User Guide - Creating a custom decoder file
    </TITLE>
    <META content="Bob Jacobsen" name=Author>
    <META content="John Plocher" name=Author>
    <meta name="keywords" content="java model railroad JMRI PacketScript user guide">

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->

</head>

<body>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>

<!-- Define logo images/decoderpro.gif -->
<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/decoderpro.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->


<hr class="hide">

    <div id="mBody">

    <!-- Or, you can delete the entire div id=side block if you don't need a -->
    <!-- side menu.  You should then add class=nomenu to the above div       -->
    <!-- Example: <div class="nomenu" id="mBody">			     -->

	<div id="side"> <!-- Block of text on left side of page -->

<div style="text-align: center">DecoderPro User Guide</div>
<dl class=toc>
<dt><a href="./Tour.html">Quick tour</A></dt><dd/>
<dt><a href="./MoreInfo.html">Details</A></dt><dd/>
<dt><a HREF="./Files.html">Configuration files</a></dt><dd/>
<dt><a HREF="./Roster.html">Working with the roster</a></dt><dd/>
<dt><a HREF="./FAQ.html">Frequently asked questions</a></dt><dd/>
<dt><a HREF="./Install.html">Downloading and installing DecoderPro</a></dt><dd/>
</dl>

<div style="text-align: center">More advanced information</div>
<dl class=toc>

<dt><a HREF="./IntroXML.html">Intro to XML files</a></dt><dd/>
<dt class="this"><a href="./CreateDecoder.html">Create your own decoder definition</a></dt><dd/>
<dt><a href="./Programmer.html">Create a custom programmer definition</a></dt><dd/>
<dt><a HREF="./RosterFile.html">How the roster is stored; updating it by hand</a></dt><dd/>
<dt><a HREF="./LocoFile.html">Locomotive (roster) files</a></dt><dd/>
<dt><a HREF="./Debug.html">Debugging</a></dt><dd/>
</dl>

	</div>

<div id="mainContent">

<div class="list">
<H2>DecoderPro User Guide - Creating a custom decoder file</h2>

<p>This page provides a little information on how the configuration
files for the DecoderPro Symbolic Programmer work.</p>

<p>In this user guide, we walk you through the process of creating a
file to describe a new decoder.  You might benefit from reading the
other sections of the DecoderPro user guide to get background
information, especially the XML introduction and the section on what
the configuration files contain.</p>

<p>The easiest way to create a configuration file is to modify an
existing one.  In this section, we walk you through doing this.</p>

<dl>
<dt class=left>Make a copy of a similar file.</dt>
<dd class=first>
<p>Although you can call this new file anything you like, it will
work best if you use the same convention as the provided files.
That's <TT>"manufacturer name"_"decoder family".xml</TT>, for example:
<TT>Digitrax_1x2.xml</TT> and <TT>Atlas_DualMode.xml</TT></p>

<p>For the provided files, we use the same capitalization, etc,
that the decoder manufacturer uses in their documentation. </p>

<p>This new file should go in the <TT>decoders</TT> subdirectory in the
<TT>JMRI</TT> preferences directory so that the program can find it.  The
<TT>DecoderProConfig.xml</TT> file lives in the preferences directory, so
you can search for that file to locate it.
(See the <a HREF="#files"><em>files section</em></a> below for further details
about how to find that directory and it's contents) </p>

<dt class=left> Edit the new file </dt>
<dd>
<p>Open the new file with your favorite editor.</p>
</dd>

<dt class=left> File contents: XML Header </dt>
<dd>
<p>You'll see something like this at the top of the file (the examples are from the <a
HREF="../xml/Digitrax_1x2.xml">XXX FIXME XXX Digitrax_1x2.xml</a> file):

<p class=example>
&lt;?xml version="1.0"?&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!DOCTYPE decoder-config SYSTEM "decoder-config.dtd"&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- $Id: CreateDecoder.html,v 1.9 2004-08-08 01:56:13 jacobsen Exp $ --&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;decoder-config&gt;<BR>
</p>

<p>Don't mess with these lines; they describe the format of the file.
</dd>

<dt class=left> File contents: Author </dt>
<dd>
<p>The next element describes the author and version of this decoder file:
<p class=example>
&lt;version author="jake@physics.berkeley.edu" <br>
&nbsp;&nbsp;&nbsp;&nbsp;version="1" lastUpdated="20011201"/&gt;
</p>
<p>These attributes are only read by people, not the program, so
their exact format isn't critical.  But we encourage you to insert
your email address in files you create or change, so that if
anybody has any questions they can find you.  The version and
lastUpdated attributes provide a way of telling different versions
of a decoder definition apart, so we'd also like you to update
those.  For a new file, set the version back to "1", and if you're
modifying an existing file, increment the version attribute to the
next number.   </p>
</dd>

<dt class=left> File contents: Decoder Family and Model</dt>
<dd>
The next lines identify the "family" of decoders that this file
describes:
<p class=example>
&lt;decoder&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;family name="Digitrax 1x2" mfg="Digitrax"<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lowVersionID="240" highVersionID="242"<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment="Digitrax DH142, etc" &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;model model="DH142" numOuts="4" numFns="2"/&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;model model="DN142" numOuts="4" numFns="2"/&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;model model="DH083" numOuts="5" numFns="2"/&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/family&gt;
</p>

<p>The spacing is not important, but its useful to ident the file
like this to make it more readable.  XML uses "elements" and
"attributes" to carry information.  The &lt;model&gt; things are
elements; attributes like numOuts are set to specific values within elements.
In the 2nd through 4th lines above

<p class=example>
&lt;family name="Digitrax 1x2" mfg="Digitrax"<BR>
&nbsp;&nbsp;&nbsp;&nbsp;lowVersionID="240" highVersionID="242"<BR>
&nbsp;&nbsp;&nbsp;&nbsp;comment="Digitrax DH142, etc" &gt;
</p>

<p>the element is 'family', with attributes 'name', 'mfg',
'lowVersionID', 'highVersionID', and 'comment'.  An attribute is
given a value with an equals sign and a value in quotes (the quotes
are required).  The order of the attributes is not important, and
you can break them across lines if that makes the file easier to
read. Note that all of the attributes must be inside the angle
brackets, and after the name of the element.</p>

<p>In this element, change the attributes to match your new decoder:
<ul>
<li><dfn>name</dfn> - the name of the decoder family.  Its best if you use the same
name here as you used in the filename.
<li><dfn>mfg</dfn> - the manufacturer of the decoder.  Its best if you use the same
manufacturer name here as you used in the filename.
<li><dfn>lowVersionID</dfn>, <dfn>highVersionID</dfn> -
The manufacturer can load a version number into CV 7 of a decoder.
Not all manufacturers do this, but if one is available the
programmer can check if this file is being used with the expected
decoder type.  If only one value is valid, define the attribute
lowVersionID, e.g.

<p class=example>
&nbsp;&nbsp;&nbsp;&nbsp;lowVersionID="123"
</p>
If the decoder type can have any one of a range of numbers,
for example because the manufacturer has made some updates,
define both attributes.
If you don't know the version number, don't define
either of these attributes.
<li><dfn>comment</dfn> - this is optional. You might want to include your name, or other
info about the changes in the file.
</ul>

<p> The following lines:</p>

<p class=example>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;model model="DH142" numOuts="4" numFns="2"/&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;model model="DN142" numOuts="4" numFns="2"/&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;model model="DH083" numOuts="5" numFns="2"/&gt;
</p>
allow you to list a number of different decoder models that can use
this file.  For a single decoder, remove all but one of the "model"
elements, and give it the model name of the decoder.  The numOuts
and numFns are described later, but for now you can just delete
them, leaving something like:</p>

<p class=example>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;model model="DH142" /&gt;
</p>

</dd>

<dt class=left> File contents: Programming Modes </dt>
<dd>

<p>The next element defines what programming modes the decoder can understand:</p>

<p class=example>
&lt;programming direct="byteOnly" paged="yes" <BR>
&nbsp;&nbsp;&nbsp;&nbsp;register="yes" ops="yes"&gt;&lt;/programming&gt;
</p>

<p>Paged, register and ops can be set to either "yes" or "no".  Direct
can be set to "no", "bitOnly", "byteOnly", or "yes".  The
programmer uses this information to select the programming mode to
use when working with a decoder.</p>
</dd>

<dt class=left> File contents: Variable names</dt>
<dd>
<p>The next part of the file consists of a set of 'variable' elements
defining specific variables, nested inside a 'variables' (note the
extra "s") element. An example:</p>

<p class=example>
&lt;variable label="Short Address" CV="1" item="Primary Address" default="03"&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;decVal min="1" max="127"/&gt;<BR>
&lt;/variable&gt;
</p>

<p>Each variable represents one thing to configure.  They can represent a
single CV, e.g. address, or a few bits that can be configured to
control a particular function.  If some of these aren't appropriate to
your decoder, you can just remove them.  Make sure you remove the
entire element from the &lt;variable&gt; to the matching
&lt;/variable&gt;.  You can also rearrange them if you'd prefer a
different order.</p>

<p> The attributes include:
<ul>
<li><dfn>label</dfn> - The name for this variable.
<li><dfn>item</dfn> - An alternative, 'standard' name. See below for
more information on this.
<li><dfn>CV</dfn> - Which CV contains the configuration information
for this variable.
<li><dfn>mask</dfn> - A pattern like "XXXVVVXX" which controls which
bits in the CV make up the variable. Each "V" is a bit
that's included, and "X" are bits that are not to be
included.  Its best to have eight characters, as that
makes it clearer what's going on.  If the variable
is a full byte, this attribute can be omitted.
<li><dfn>default</dfn> - The default value for this variable. This is
used for a new decoder, or when you want to set the
decoder back to its defaults.
<li><dfn>comment</dfn> - Use this for whatever you want.
</ul>

<p>(There are a few more, which we'll leave for the advanced section below)</p>
</dd>

<dt class=left> File contents: Creating new Variable names</dt>
<dd>
<p>You can also define new variables. A good starting point is to
copy a similar definition, change its name to a new value, and then
edit its contents.</p>

<p> To define how the new variable is displayed and editted, you
add elements within the 'variable' element.  There are several
possible forms:
<ul>
<li>For a decimal value, you include a decVal element like the
example above.  The two optional attributes are min and max,
which define the range of acceptable values. If you
omit them, values from 0 to 255 are allowed.
<li>If you'd rather enter and display values in hexadecimal, use a
'hexVal' element. Its otherwise the same as the
'decVal' element we've already discussed.
<li><p>If your decoder supports a long address, you can add a
'longAddress' element. Its perhaps easiest to copy
this from another file, or from this example:</p>

<p class=example>
&lt;variable name=&quot;Long Address&quot; CV=&quot;17&quot;&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;longAddressVal/&gt;<BR>
&lt;/variable&gt;
</p>

<li><p>If your decoder supports it, you can enter a 'speedTableVal'
element for the speed table.  The only attribute is "entries",
which can be either "28", "14" or some other value.  Example:</p>

<p class=example>
&lt;variable name=&quot;Speed Table&quot; CV=&quot;67&quot;&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;speedTableVal/&gt;<BR>
&lt;/variable&gt;
</p>

<li>Some decoder options are best represented by "choose one
choice". These are represented by a enumVariable element. Example:

<p class=example>
&lt;variable name=&quot;F6 during DC operation&quot; CV=&quot;13&quot; mask=&quot;XXVXXXXX&quot;&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;enumVal&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;enumChoice choice=&quot;Off&quot;/&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;enumChoice choice=&quot;On&quot;/&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/enumVal&gt;<BR>
&lt;/variable&gt;
</p>

<p>Each enumChoice element describes one possibility.  There can be as
many of these as desired.  For a one bit choice, you use two
enumChoice elements as in the example.  For a 4 bit choice, like
the FX codes in a Digitrax decoder, you can use up to 16 choices.
They are displayed in the order they are entered in the file, and
are also numbered in that order.  If the first is chosen, a 0 is
entered in the CV bits; choosing the second stores 1; etc.</p>

<p> If you need to specific a specific number for an enum option,
add a "value" attribute:
<p class=example>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;enumChoice choice=&quot;Blue&quot; value=&quot;32&quot;/&gt;
</p>
</ul>

<dt class=left> Checking for syntax errors</dt>
<dd>
<p>At this point, you've created a new configuration file!</p>

<p>You can check it for syntax by selecting the "Check XML file"
item from the "Debug" menu.  It opens a file selection dialog;
select your file and click "open".  If all is well, you'll get a
dialog box that says "OK".  If not, you'll get a completely
incomprehensible error message. About the only useful part of that
message is the line number; open an editor to that line and try to
see what's wrong with the syntax.
</dd>

<dt class=left> Add the file to the index</dt>
<dd>
<p>All that's left is to enter your new file in the index.  This
index is used to speed the startup of the program, when the list of
available decoders is constructed.</p>

<p> Select the "Create decoder index" item from the "Debug"
menu.</p>
</dd>
</dl>
<p>Congratulations!  You're done.  Next, open the programmer
application and try it.</p>
</div>


<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 2003,2004 JMRI Community</p>
        <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

</div><!-- closes #mainContent-->
</div> <!-- closes #mBody-->
</body>
</html>

