<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: CMRI.html,v 1.13 2007-01-01 22:37:15 jacobsen Exp $ -->
<html lang="en">
<head>
 <TITLE>
      JMRI Hardware Guide: Chubb C/MRI
 </TITLE>
    <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
    <META content="Bob Jacobsen" name=Author>
    <META name="keywords" content="Bruce Chubb C/MRI Computer interface java model railroad JMRI install windows">

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
<div id="container">
  <p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>
<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/logo-jmri.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->





  <hr class="hide">

  <div class="nomenu" id="mBody">
    <div id="mainContent">
      <H2> 
      JMRI Hardware Guide: Chubb C/MRI
      </H2>
      
	<H3>Supported Hardware</H3>

	<UL>
	<li>Chubb C/MRI USIC
	<li>Chubb C/MRI SMINI
	<li>Chubb C/MRI SUSIC
	<li>TracTronics
	</UL>


    <h3>C/MRI Input and Output Bits </H3>                                                                                          JMRI refers to C/MRI input bits as sensors.  You refer to a C/MRI input bit (sensor) as CSnxxx where nxxx is the address of the bit (see below).  
    
	<P>C/MRI inputs can be used as 'sensors', and C/MRI outputs can be driven 
	as 'turnouts' or 'lights'. Note that C/MRI inputs and 
	outputs are sometimes called 'pins', sometimes called 'bits', 
	and sometimes called 'lines'; all are equivalent ways to refer to same things.

    <P>JMRI refers to C/MRI output bits as turnouts or lights.  
    To refer to a C/MRI output bit as a turnout, 
    use the system name CTnxxx, where nxxx is the address of the bit (see below). To refer to a C/MRI output bit as a light, use CLnxxx, where nxxx is the address of the bit (see below). Turnouts and lights are different methods of referring to C/MRI outputs.  Each method has different control options. Always use 'turnouts' for C/MRI outputs used to control turnouts (switches) and for C/MRI outputs used to operate signals.  For historical reasons, C/MRI output bits used to control signal aspects are referred to as 'turnouts', even if the output bits are used to control lighted signals.  Use 'lights' to refer to C/MRI output bits used for fascia panel lights, for lights in scenery (structure lighting, street lights, etc.), and for special purposes where the control options for lights suit your needs.
    
    <P>A specific output bit may be referred to as a turnout or a light, but not both. 
    When a new C/MRI turnout or a new C/MRI light is created, JMRI checks that 
    the specified output bit is available for assignment.  
    If the requested C/MRI output bit is in use by a turnout or a light, 
    JMRI will refuse to create the new turnout or new light.  
    Note that some C/MRI turnout control options use two bits, the addressed one and the 
    next one (see below), and that both output bits must be unassigned for successful 
    creation of a new turnout controlled by two output bits. 
    Lists of current C/MRI bit assignments can be obtained by selecting 
    System &gt; CMRI &gt; List Assignments.

	<H3>Using Specific C/MRI Boards</H3>

	<p>The JMRI libraries have built-in support for C/MRI serial hardware using the 
	USIC, SUSIC and SMINI. 
	Each SMINI, USIC or SUSIC is called a "node". 

	<p>At this time, the directly connected IBEC and UBEC interfaces are
	not supported.</p>

	<dl>
	<dt class=left>Use with an SMINI board</dt>
	<dd class=top>
	    <p>It's easiest to try JMRI with a SMINI board, as there's no
	    options to be configured for the C/MRI hardware.
	    <ol>
		<li>Start the JMRIdemo program
		<li>From the edit menu, select preferences and configure:
	        <ul>
		    <li>Protocol as "C/MRI serial"
		    <li>For serial port, select the one your hardware is attached to.
		    <li>Select the baud rate your C/MRI system uses
		    <li>Click the "Configure C/MRI nodes" button. On the
		        new panel that opens:
		        <UL>
		        <LI>Enter a node address (0 is typically used for the first card)
    		    <li>Select "SMINI" from the initialization box
    		    <li>Click "Add Node"
    		    <LI>Click "Done"
    		    </ul>
		    <li>Back on the "Preferences..." panel, click "Save", and say yes when it asks if you want to quit.
	        </ul>
		<li>Restart the program. Your SMINI's red and yellow
		LEDs should now be flashing, indicating that the computer and
		SMINI are talking.
		<li>To check that everything is working, select "Turnout
		Control" from the tools menu.  This will open a small window in
		which you can select a turnout number (<a href="#numbers">see
		below</a>), then click closed/thrown to change the state of
		that output.
	    </ol>
	</dd>

	<dt class=left>Use with other C/MRI hardware</dt>
	<dd>
	<p>A C/MRI system needs an initialization string before it can
	communicate. The program will automatically create that, but
	you need to specify the details of how your C/MRI hardware
	is set up.  To do this:
	    <ol>
		<li>Start the JMRIdemo program
		<li>From the edit menu, select preferences and configure:
	        <ul>
		    <li>Protocol as "C/MRI serial"
		    <li>For serial port, select the one your hardware is attached to.
		    <li>Select the baud rate your C/MRI system uses
		    <li>Click the "Configure C/MRI nodes" button. On the
		        new panel that opens:
		        <UL>
		        <LI>Enter a node address (0 is typically used for the first card)
                <LI>Select "USIC_SUIC" in the "node type box". 
                <LI>Leave DL at zero.
                <LI>Select "24-bit" or "32-bit" in "Card size", depending
                    on whether you have the original 24 bit or newer 32 bit 
                    DI and DO cards.
                <LI> Configure your cards in the table below that.  
                    For each card you've got installed, click where it 
                    says "No Card" and select "Input 
                    Card" or "Output Card"    		    
                <li>Click "Add Node"
    		    <li>If you have additional nodes, you can enter their address
    		    and repeat the process now.  To make debugging
    		    simpler if anything goes wrong, it might be better to just get
    		    one working at first, and come back later to add the rest of the nodes.
    		    <LI>Click "Done"
    		    </ul>
		    <li>Back on the "Preferences..." panel, click "Save", and say yes when it asks if you want to quit.
	        </ul>
		<li>Restart the program. The transmit and receive
		LEDs on your C/MRI controller should now be flashing, indicating that the computer and
		controller are talking.
		<li>To check that everything is working, select "Turnout
		Control" from the tools menu.  This will open a small window in
		which you can select a turnout number (<a href="#numbers">see
		below</a>), then click closed/thrown to change the state of
		that output.
	    </ol>
	
	</dd>

	<dt class=left><a name=signals>Wiring Signals</a></dt>
	<dd>
    JMRI can work with all the popular ways of wiring 
    signals to C/MRI hardware (and there are a lot of them!)
    For information on how to configure your signals to the
    program, please see the 
    <A HREF="cmri/Signals.html">C/MRI signals</a> page.
    </dd>
    
    
	<dt class=left><a name=numbers>Numbering</a></dt>
	<dd>
	<p>C/MRI system names start with "C". For example, "CS24" is a C/MRI
	"S"ensor, the 24th input line.</p>

	<p>Inputs and outputs are numbered sequentially from 1, without
	worrying about the types of cards, etc. For example, if you have two
	24-input cards, CS25 refers to the 1st input line on the second card.
	If you have two 32 input cards, CS25 refers to the 25th input line on
	the first card.</p>

	<p>Each SMINI, USIC or SUSIC is called a "node". Sensors and turnouts
	on the first node are numbered from 1 to 999; sensors and turnouts on
	the second node are numbered 1001 to 1999; etc. </p>
	
	<P>For example:
	<UL>
	<LI>Say you have a SMINI with it's address switches set to "2". All of the
	inputs and outputs on that node will be numbered starting with 2001.  
	    <UL>
	    <LI>CT2001 is the first output pin
	    <LI>CT2048 is the last output pin
	    <LI>CS2001 is the first input pin
	    <LI>CS2024 is the last output pin.
	    </UL>
	<LI>If you have a USIC with it's address switches set to "1", it will
	have all it's inputs and outputs numbered starting with 1001.  If it has
	three 24-bit input cards, and two 24-bit output cards, their addresses will be:
	    <UL>
	    <LI>CT1001 is the first pin on the 1st output card
	    <LI>CT1024 is the last pin on the 1st output card
	    <LI>CT1025 is the first pin on the 2nd output card
	    <LI>CT1048 is the last pin on the 2nd output card
	    <LI>CS1001 is the first pin on the 1st input card
	    <LI>CS1024 is the last pin on the 1st input card
	    <LI>CS1025 is the first pin on the 2nd input card
	    <LI>CS1049 is the first pin on the 3rd input card
	    <LI>CS1072 is the last pin on the 3rd input card
	    </UL>
	Note that it doesn't matter what order the cards are installed, etc. That's
	all configured when you put together the hardware, and when you define
	the C/MRI preferences to the program (see above). 
	<LI>Is you have a SUSIC with it's address switches set to "4", the inputs
	and outputs will be numbered starting with 4001.  If it has two 32-bit input
	and two 32-bit output
	cards, their addresses will be:
	    <UL>
	    <LI>CT4001 is the first pin on the 1st output card
	    <LI>CT4032 is the last pin on the 1st output card
	    <LI>CT4033 is the first pin on the 2nd output card
	    <LI>CT4064 is the last pin on the 2nd output card
	    <LI>CS4001 is the first pin on the 1st input card
	    <LI>CS4032 is the last pin on the 1st input card
	    <LI>CS4033 is the first pin on the 2nd input card
	    <LI>CS4064 is the last pin on the 3rd input card
	    </UL>
	
	</UL>

    <P>To summarize, input and output pins are labelled sequentially
    within each C/MRI node.  The numbers go up by 1000 from node to 
    node.  Node numbers can go as high as the C/MRI hardware allows.
    	
    </dd>

<dt class=left><a name=alternate>Alternate Numbering for System Names</a></dt>
<dd>
An alternate scheme for numbering in C/MRI system names was developed 
to give user access to the full number of lines allowed by C/MRI hardware design.
The main numbering system (documented above) allows access to 999 input 
and output lines on each node.
The C/MRI hardware design, however, supports many more bits for USIC and SUSIC modules.
Most JMRI users will never need this alternate scheme,
and should use the main numbering scheme.
<P>
The alternate numbering scheme is similar to the main numbering scheme,
except the node number and bit number are separated by a "B",
and both node number and bit number can range to any value supported by C/MRI.
For example, CS1B13 refers to input line 13 of node 1, and is equivalent to CS1013
in the main numbering scheme.
Also CT2B1109 refers to output line 1109 of node 2,
and there is no equivalent in the main numbering scheme.
Users may use either numbering scheme interchangeably for line numbers up to 999,
but must use the alternate numbering scheme for line numbers greater than 999.
</dd>

<dt class=left><a name=options>C/MRI Turnout Control Options</a></dt>
<dd>
Turnouts (switches) may be controlled using one or two output bits.  
When a turnout is created using the Add option in the Turnout Table, 
the user is asked whether the turnout is to be controlled using one 
or two output bits.  
<P>
If one-output-bit control is selected,
then that output bit is set "Off" for CLOSED ('normal' in C/MRI manuals) 
or "On" for THROWN ('reverse' in C/MRI manuals). 
When setting the output bit, JMRI compares the requested state to the
state indicated by the current value of the output bit.
If these states are different, then the output bit is set as indicated above.
If these states are the same, that state is compared to the state indicated
by turnout feedback.
If the states are the same, no action is taken since the turnout is already
in the requested state.
If the states are different, the turnout was probably changed by some
means separate from JMRI.
To ensure the turnout is actually set to the requested state,
the output bit is first changed to match the state indicated
by the turnout feedback, then one second later it is changed again
to match the requested state.
This guarantees a change of state for those turnout control
devices that require a change in state to actually move the turnout.
<P>
If two-output-bit control is selected, the bit referenced in the turnout
system name (see above) and the next bit in sequence
are used to control the turnout.
For example, if CT33 has two-output-bit control,
the 33rd and 34th bits are used to control the turnout.
If two-output-bit control is selected, the user must select either
'steady state' or 'pulsed' control.
Steady state control should be selected for stall motor turnouts,
such as a Tortoise,
if it is being controlled according to the recommendation in Chubb's
C/MRI User's Manual, Version 3.0, page 3-12.
With steady state control, for CLOSED, the first bit is set "Off" and
the second bit is set "On"; for THROWN, the bits states are reversed, 
i.e., the first bit is set "On" and the second bit is set "Off". 
With pulsed control, both bits are off when nothing is happening. 
When CLOSED or THROWN is requested, this request is compared to 
the known state of the turnout (which follows turnout feedback). 
If the known state indicates the turnout is already in the requested state, 
nothing is done.
If the known state is different from the requested state, 
then the first bit is pulsed if CLOSED is requested,
or the second bit is pulsed if THROWN is requested.
In either case, a 'pulse' consists of the bit being turned on for one second,
then returned to the off position.
<I>Note that to have two-output-bit control,
a turnout must be created using the "Add" button in the Turnout Table.</I>
</dd>
<dt class=left><a name=diagnostics>C/MRI Diagnostics</a></dt>
<dd>
JMRI supports the two automated diagnostic procedures mentioned in 
Chapter 6 of Bruce Chubb's C/MRI User's Manual, Version 3.0.  
These automated procedures are controlled via a dialog available by 
selecting System>CMRI>Run Diagnostic.
The Wraparound Test requires a special wraparound test cable,
and the Output Test requires a special output test card.
</dd>
	</dl>

	<H3> More info </H3>
    	<p>For more information on C/MRI, please see the </p>
	<p><a HREF="http://www.jlcenterprises.net/">JLC Enterprises web site</a>
	and the 
	<a HREF="http://groups.yahoo.com/group/CMRI_Users/">C/MRI yahoo users group</a>.
	</p>

      <hr class="hide">
<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 1997 - 2004 JMRI Community. 
	<P>JMRI, DecoderPro, PanelPro, DispatcherPro and associated logos are our trademarks.
	<P><A href="/Copyright.html">Additional information on copyright, trademarks and licenses is linked here.</a></p>
    
       <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->
   </div><!-- closes #mainContent-->
  </div> <!-- closes #mBody-->
</div> <!-- closes #container -->
</body>
</html>

