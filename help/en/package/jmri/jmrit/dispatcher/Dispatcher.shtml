<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: Dispatcher.shtml,v 1.4 2009-02-05 23:54:11 djduchamp Exp $ -->
<html lang="en">
<head>
 <TITLE>
      JMRI: Dispatcher Help
 </TITLE>
    <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
    <META content="Dave Duchamp" name=Author>
    <META name="keywords" content="JMRI help Dispatcher">

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
<!--#include virtual="/Header" -->
  <div class="nomenu" id="mBody">
    <div id="mainContent">

<H1>Dispatcher</H1>

<a name="contents"><h2>Contents</h2>

<p>This document describes <b>Dispatcher</b>, and how to use Dispatcher to 
help with dispatching and running trains on layouts with PanelPro panels. The 
document is divided into sections; click below to jump to the named section. 
Underlined items are links to sections of this document or to other help files.</p>
<ul>
	<li><a href="#intro">Introduction to Dispatcher</a></li>
	<li><a href="#glossary">Glossary of Terms</a></li>
	<li><a href="#transits">Using Transits and Sections in Dispatching Active 
	Trains</a></li>
	<li><a href="#window">The Dispatcher Window</a></li>
	<li><a href="#atrains">The Active Trains Table</a></li>
	<li><a href="#arequests">The Allocation Requests Table</a></li>
</ul>

<a name="intro"><H2>Introduction to Dispatcher</H2>

<p><b>Dispatcher</b> provides functions and organizes information relating to 
dispatching trains on a model railroad layout. It's main function is allocation 
of sections of track to various trains running around the layout. Dispatcher is 
not designed to completely replace a human dispatcher during a session of 
running trains, but it should make the dispatching job easier and more fun. 
Dispatcher is envisioned to work alongside a panel, constructed in either 
Layout Editor or Panel Editor, which provides visual feedback of layout status. 
There was no attempt to make Dispatcher look or feel <i>prototypical</i>. It 
was simply designed to be functional for dispatching a model railroad layout.</p>
<p>Dispatcher requires that a layout be divided into <b>Blocks</b>, and that 
Blocks along the mainline be organized into 
<b><a href="../beantable/SectionTable.shtml">Sections</a></b>. It also requires 
that Sections be used to define routes, called 
<b><a href="../beantable/TransitTable.shtml">Transits</a></b>, that describe 
paths that trains will follow when active on the layout. <b>Blocks</b> are 
portions of track whose occupancy can be monitored individually. <b>Sections</b> 
are groups of Blocks that are <i>allocated</i> as a unit by the dispatcher using 
<b>Dispatcher</b> functions. <b>Blocks</b> are usually defined to facilitate signaling 
on a layout. Dispatcher does not require that block detection hardware or signals 
be installed on the physical layout, or even that the physical layout be divided 
into blocks. Dispatcher will work if layout blocking is defined in a panel only. 
However, Dispatcher works best if hardware blocks with block detection are present. 
It works even better if hardware signals are present on the layout, and 
signal logic uses Section direction sensors.</p>
<p>Functionality provided by Dispatcher includes: support for train start up and 
termination, information to allow easy set up of meets at passing sidings, 
automation of some dispatcher functions, set up of automatic running of trains
(including automatic station stops for passenger trains), support for linking
signals to allocation via simple APB signaling support, and automatic setting 
of turnouts when a section of track is allocated. Many of these functions are 
included in the current version of Dispatcher; others will follow in future 
releases of JMRI.</p>
<p>Central to <b>Dispatcher</b> is the <b>Active Train</b>, which carries the 
information needed to run a train around the layout. Basically, an <b>Active Train</b> 
is created by the dispatcher by combining a <b>Transit</b> with a <b>Train</b>. 
The <b><a href="../beantable/TransitTable.shtml">Transit</a></b> provides a 
description of the route to be followed by the Train, including which 
<b><a href="../beantable/SectionTable.shtml">Sections</a></b> need to be 
allocated along the route, and any <b><i>special actions</i></b> that need to 
take place in specific Sections. The <b>Train</b> specifies what is to be run 
along the route specified by the Transit. Trains can be complete descriptions of 
all engines and cars as provided by JMRI <b>Operations</b>, or engines selected 
from the JMRI <b>Roster</b> menu, or simply a train name and dcc address entered 
by the dispatcher.</p>
<p>When creating an Active Train, the dispatcher also specified where the Active 
Train is currently located, and the location of the Active Train when it is 
terminated after it completes its transit of the layout. Other options, like 
train priority and a request to run the Active Train automatically may also be 
entered. More options are expected to be added in the future as more 
functionality is added to JMRI.</p> 
<p>All Active Trains are displayed in a table in the <b>Dispatcher Window</b>, 
along with status information about the Active Train. The Dispatcher Window 
also contains a table of pending <b>Allocation Requests</b>, and buttons that allow 
the dispatcher to easily allocate Sections, create new Active Trains, terminate 
Active Trains, and display a table of all <b>Allocated Sections</b>. Allocated 
Sections are released using buttons in the Allocated Sections table. The 
<b><a href="#window">Dispatcher Window</a></b> is discussed in detail below.</p>
<p><b>Note: The current version of JMRI does not have automated dispatching or 
automatic running of trains.</b> Those optional features will be added in 
future releases.</p>
<p>Many of the terms in this introduction to Dispatcher may be new to users. 
Some were created specifically for use with Dispatcher. Please briefly review 
the <b>Glossary of Terms</b> which follows, and come back to it as needed when 
reading the remainder of this documentation. Note that "<i>Dispatcher</i>" refers 
to the Dispatcher software, and "<i>the dispatcher</i>" refers to the person 
running the Dispatcher software.</p>

<a name="glossary"><H2>Glossary of Terms</H2>

<p><b>Block</b> - A portion of track whose occupancy may be individually monitored. 
Blocks are defined by subdividing the track in a layout. Blocks normally correspond 
to physical blocks on a layout, each wired for occupancy detection. However, if 
the layout track is not subdivided into blocks, dividing a Layout Editor panel 
into blocks will allow Dispatcher to be used. For Dispatcher use, blocking of 
mainline track is required. Hardware occupancy detection is optional. Dispatcher 
works best if hardware block occupancy detection is present, but it can work 
without it.</p>
<p><b>Section</b> - A group of one or more connected <b>Blocks</b> that may be 
allocated to a train for travel in a given direction. Blocks are normally defined 
to facilitate signals. This often results in short Blocks, sometimes containing 
only one track switch. Sections allow Blocks to be grouped into track 
sections that are reasonable for a dispatcher to allocate. More information is 
contained in the <b><a href="../beantable/SectionTable.shtml">Section Table</a></b> 
help file, along with instructions on how to create a Section.</p>
<p><b>Transit</b> - A group of two or more connected <b>Sections</b> that describes
a route around the layout for a train traveling in a given direction. Transits 
are required for Dispatcher, and at least one must be defined before Dispatcher 
can be opened. A detailed description of Transits, how they are created, and 
how they are used is contained in the 
<b><a href="../beantable/TransitTable.shtml">Transit Table</a></b> help file.</p>
<p><b>Train</b> - An engine (or consist) usually attached to a group of cars, 
that travels around the layout as an entity. For use with Dispatcher, trains 
may be selected from engines in the JMRI engine roster, may be selected from trains 
created in JMRI Operations, or train information may be entered manually by 
the dispatcher.</p>
<p><b>Active Train</b> - A combination of a Train and a Transit, along with other 
information and options. The Train describes what is traveling, and the Transit 
describes where it is going. Details are filled in by other information and options
selected when the Active Train is created. Active Trains are central to Dispatcher. 
How Active Trains are used is described in detail <a href="#transits">below</a>. 
The <b><a href="#atrains">Active Trains Table</a></b> section below provides more 
details. Active Trains are created and terminated from the Dispatcher window.</p>
<p><b>Allocation Request</b> - A request to allocate (assign) a <b>Section</b> for 
the exclusive use of an <b>Active Train</b>. Allocation Requests that are not 
immediately acted upon are gathered in a queue that is displayed in the Dispatcher 
window. Action on an Allocation Request can be delayed for a number of reasons, 
for example, if the requested Section is not FREE, but is allocated to a Active 
Train.</p>
<p><b>Allocated Section</b> - A <b>Section</b> that is currently assigned to an 
<b>Active Train</b>. When a Section is allocated, if there are alternate Sections 
following the Allocated Section, the dispatcher must choose the next Section from the 
alternate Sections contained in the Transit. A window listing all Allocated Sections 
may be displayed by clicking a button in the Dispatcher window. This Allocated 
Section window is where Sections are released manually by the dispatcher.</p>
<p><b>Alternate Section</b> - An <i>alternate</i>  <b>Section</b> connecting two 
Sections in a <b>Transit</b>. In user-specified areas of a Transit, <i>alternate</i> 
Sections may be designated. For example, to move between the "2nd" and "4th" 
Sections in a Transit, there may be multiple "3rd" Sections, any of which might 
be used to travel between the 2nd and 4th Sections. Alternate Sections provide for 
passing tracks and staging yards.</p>

<a name="transits"><H2>Using Transits and Sections in Dispatching 
Active Trains</H2>

<p>When a <b>Transit</b> is paired with a <b>Train</b> to form an <b>Active Train</b>, 
the starting Block (Active Train location at start) and ending Block (Active Train 
location when the travel is complete) are specified. The Active Train is referred to by 
its Train name and its Transit name, each of which must be unique among Active 
Trains. A Train and a Transit may be in only one Active Train at a time. When 
an Active Train is terminated, its Transit and its Train are <i>deactivated</i>, 
and both may be reused in different Active Trains.</p>
<p>An Active Train usually starts from a Block outside of the Transit, but connected 
to a Block within the Transit. Optionally a train may start from a Block within a 
Section in the Transit. A train moves through a Transit in only one direction--
defined by the order in which Sections are included in the Transit. Trains move 
from lower sequence number Sections toward higher sequence number Sections. When 
an Active Train is created, an <b>Allocation Request</b> is placed for a starting 
<b>Section</b>. If the Section is free, the Section will be <i>allocated</i> to 
the Active Train. <i>Allocation</i> means that the Section is assigned to the Active 
Train, and the Active Train is authorized by the dispatcher to proceed to the 
end of that Section.</p>
<p>An Active Train may be run by an engineer using a throttle, or automatically 
by the computer. Dispatching for the Active Train consists of <i>allocating</i> 
Sections, one by one, to the Active Train, and holding the Active Train in a 
Section as needed when its needs conflict with the needs of other Active Trains. 
The actual allocation may be done by the dispatcher by manually clicking 
buttons in the Dispatcher Window, or the dispatcher may request <b>Auto Allocate</b> 
in the <b><a href="Options.shtml">Options</a></b> menu of the Dispatcher window, 
and allow the computer do some of the routine work. If a requested Section is 
currently in use, an Allocation Request is placed in the Allocation Request 
table in the Dispatcher window.</p>
<p>Transits provide for a special action to be performed when a train is in a 
Section.  Currently two special actions are supported: <b>Pause</b> for a user-designated 
number of fast clock minutes, and <b>Await</b> a manual restart. The Pause action 
may be used for automatic station stops. The Await action is designed to support 
an engineer doing work in a specified Section, and requesting a restart when the 
work is complete. More actions may be added in the future as needed.</p>

<a name="window"><H2>The Dispatcher Window</H2>

<p>The <b>Dispatcher</b> window is opened when <b>Dispatcher...</b> is selected 
in the JMRI <b>Tools</b> menu. It displays a table of <b>Active Trains</b> and 
their status, and a table of pending <b>Allocation Requests</b>. It provides 
buttons that allow the dispatcher to easily allocate Sections, create new Active 
Trains, terminate Active trains, and display a table of all 
<b><a href="AllocatedSections.shtml">Allocated Sections</a></b>. Allocated Sections 
are <i>released</i> using buttons in the Allocated Sections table. Dispatcher 
window buttons are discussed below. The 
<b><a href="#atrains">Active Trains</a></b> table and the Allocation Request 
table are discussed in the following sections.</p>
<p>A typical Active Trains window early in a train running session is shown below.
</p>
<img src="DispatcherWindow.jpg" height="386" width="843">
<p>In the example window above, two Active Trains have been created. The top 
Active Train, ATSF4581, has been allocated a Section and is RUNNING. The second 
Active Train, SP234 is WAITING for its first allocation. An Allocation Request 
has been entered for the first Section needed by SP234. The requested Section is 
FREE and UNOCCUPIED, so it could be allocated by clicking the <b>Allocate</b> 
button in the lower table or the <b>Allocate Next</b> button in the upper table.</p>
<p> The four buttons below the Active Trains table are described below:
<ul>
<li><p><b>New Train...</b> - Click this button to bring up an <b>Activate New 
Train</b> window that allows the dispatcher to create an Active Train. The 
Train source used by this window is set in the 
<b><a href="Options.shtml">Options</a></b> window. More information on creating 
new Active Trains may be found in the help file for the 
<b><a href="Options.shtml">Activate New Train</a></b> window, along with a 
simple procedure to follow when creating an Active Train. Options should 
not be changed with the Activate New Train window open.</p>
</li>
<li><p><b>Show Allocations...</b> - Click this button to bring up a window 
containing a table that displays all <b>Sections</b> currently allocated to 
<b>Active Trains</b>. The <b><a href="AllocatedSections.shtml">Allocated 
Sections</a></b> window displays information about each Allocated Section and 
provides for <b><i>release</i></b> of Allocated Sections. This table is in a 
separate window, instead of being included in the Dispatcher window to allow more 
flexibility in placing windows on the computer screen.</p>
</li>
<li><p><b>Allocate Extra...</b> - Click this button to bring up a window that 
allows the dispatcher to allocate Sections to an Active Train that may not be 
the "next" Section in the Active Train's Transit. Any Section that is FREE and 
is connected to an Allocated Section of the Active Train may be allocated to 
the Active Train using this window. More information and a simple procedure for 
allocating extra Sections may be found in the help file of the 
<b><a href="Options.shtml">Allocate Extra</a></b> window.
</li>
<li><p><b>Terminate Train...</b> - Click this button to <b><i>terminate</i></b> 
an <b>Active Train</b>. A small window appears to allow the selection of which 
<b>Active Train</b> the dispatcher wants to terminate. When an Active Train is 
terminated, all Sections allocated to it are automatically released. The Train 
and Transit are freed up to be used in other Active Trains as needed.</p>
<p>An Active Train is usually terminated 
when it reaches its destination Block, however, it may be terminated at any point 
during its transit of the layout. The dispatcher is responsible for deciding 
whether it is appropriate to terminate an Active Train before it reaches its 
destination.</li>
</li></ul>
<p>Dispatcher options allow tailoring of the dispatcher function. Options are 
accessed via the Dispatcher window's Options menu. Descriptions of currently 
available options, the Options menu, the Options window are contained in 
the <b><a href="Options.shtml">Options</a></b> help file.</p>

<a name="atrains"><H2>The Active Trains Table</H2>

<p>Each row of <b>Active Trains</b> table corresponds to one Active Train. The 
columns are explained below.
<ul>
<li><p><b>Transit</b> - The name of the Transit of the Active Train is shown. 
The displayed name is the system name followed by the User Name in parentheses.
</p></li>
<li><p><b>Train</b> - The name of the Train of the Active Train is shown.</p>
</li>
<li><p><b>Train Status</b> - Active Train status is displayed here. An Active 
Train may have any one of the following statuses:
	<ul>
	<li><b>RUNNING</b> - Actively running on the layout, according to its mode 
	of operation.</li>
	<li><b>PAUSED</b> - Paused waiting for a user-specified number of fast clock 
	minutes.  The Active Train is expected to move to either RUNNING or WAITING 
	once the specified number of minutes has elapsed. This is intended for 
	automatic station stops.</li>
 	<li><b>WAITING</b> - Stopped waiting for a Section allocation. This is the 
 	status the Active Train is in when it is created.</li>
	<li><b>WORKING</b> - Performing work under control of a human engineer. This 
	is the status an Active Train assumes when an engineer is picking up or 
	setting out cars at industries or in a yard.</li>
 	<li><b>READY</b> - Indicates the Active Train has completed WORKING, and is 
 	<i>awaiting</i> a restart - dispatcher clearance to resume running.</li>
 	<li><b>DONE</b> -  Indicates the Active Train has reached its destination 
 	and is ready to be terminated by the dispatcher.</li> 
	</ul></p>
<p>Not all Active Trains will use all the above statuses.</p>
<p><b>Note: In the current version of Dispatcher all statuses are not 
implemented.</b> More statuses will be implemented as functionality is added 
in future JMRI versions.</p>
</li>
<li><p><b>Mode</b> - Mode of operation of the Active Train is displayed. The 
following modes are allowed:
	<ul>
	<li><b>DISPATCHED</b> - Indicates the Active Train is run by an operator  
 	using a throttle. A dispatcher will allocate Sections to the Active Train as 
 	needed, control optional signals using a CTC panel or computer logic, and 
 	arbitrate any conflicts between Active Trains. If signals are present, the 
 	operator is expected to follow signals as set by the computer or the 
 	dispatcher.</li>
 	<li><b>AUTOMATIC</b> - Indicates the Active Train will be run under automatic 
	control of the computer. Under AUTOMATIC running, the computer is expected 
	to follow signals set by the dispatcher. Automatic station stops will 
	occur, as described above. If the Active Train reaches a Section where 
	work must be done (e.g. setting out or picking up cars), the mode of 
	operation changes to MANUAL until the work is complete. Restarting from 
	MANUAL work changes the mode back to AUTOMATIC.</li>
 	<li><b>MANUAL</b> - Indicates an Active Train running in AUTOMATIC mode has 
 	reached a Special Action in its Transit that requires MANUAL operation. 
	When this happens, the status changes to WORKING, and the mode changes to 
	MANUAL. While in MANUAL mode, the Active Train is run by an operator  
	using a throttle. AUTOMATIC running is resumed when the work has 
	been completed.</li>
	</ul></p>
<p><b>Note: In this version of Dispatcher, only DISPATCHED mode is implemented.
</b> Automatic running of Active Trains will be added in a future release of 
JMRI.</p>
</li>
<li><p><b>Allocated Section</b> - Displays the name of the <b>Section</b> of the 
<b>Transit</b> that was last allocated to this Active Train.
</li>
<li><p><b>Next Section</b> - Displays the name of the <b>Section</b> of the 
<b>Transit</b> that will need to be allocated next.
</li>
<li><p><b>Allocate Next Button</b> - Click this button to request that the 
<b>Section</b> shown in the <b>Next Allocation</b> column be allocated to this 
Active Train. If the Section is FREE and not occupied it will be allocated 
immediately, and the Sections in the Allocated Section and Next Section columns 
will be updated.</p>
<p>If the Section is not FREE, an <b>Allocation Request</b> will 
be entered into the <b>Allocation Requests</b> table (see below). If the Section 
is FREE, but is OCCUPIED, the dispatcher will be queried. The dispatcher is 
responsible for deciding whether an OCCUPIED Section should be allocated. If 
the Next Section is the first Section to be allocated, and the Active Train 
is occupying that Section, Dispatcher knows that allocating the OCCUPIED 
Section is appropriate, so the dispatcher is not queried.
</li>
</ul>

<a name="arequests"><H2>The Allocation Requests Table</H2>

<p>This table, headed <b>Requested Allocations waiting for Dispatch</b>, 
displays pending <b>Allocation Requests</b>. Each row corresponds to one 
<b>Allocation Request</b>. Columns are explained below.
<ul>
<li><p><b>Active Train</b> - Shows the <b>Active Train</b> requesting the Section. 
Active Train names are displayed in either short form (shown above) or long form 
depending on the option selected in the Dispatcher's 
<b><a href="Options.shtml">Options</a></b> window.</p>
</li>
<li><p><b>Priority</b> - Shows the priority of the <b>Active Train</b> requesting 
the Section. Larger numbers are higher priority. If two Active Trains are 
requesting the same Section, the higher priority Active Train would normally 
take precedence.
</li>
<li><p><b>Requested Section</b> - Shows the name of the requested <b>Section</b>.
</li>
<li><p><b>Section Status</b> - Shows the allocation status of the requested 
<b>Section</b>. The Section will be either:
	<ul>
	<li><b>FREE</b> - Available for allocation.
	</li>
	<li><b>ALLOCATED</b> - Allocated to a different Active Train.	
	</ul>
</li>
<li><p><b>Occupancy</b> - Shows the occupancy of the requested <b>Section</b>. 
Three entries are possible:
	<ul>
	<li><b>UNOCCUPIED</b> - Nothing is detected in any Block of the Section. 
	(The occupancy sensors of all Blocks in the Section are INACTIVE.)
	</li>
	<li><b>OCCUPIED</b> - Something is detected in one of the Blocks of the 
	Section. (The occupancy sensor of at least one Block in the Section is 
	ACTIVE.)
	</li>
	<li><b>UNKNOWN</b> - The occupancy status of at least one of the Blocks of 
	the Section is not known. This indicates that the occupancy sensor of at least 
	one Block in the Section is neither ACTIVE nor INACTIVE. <b>- OR-</b> The 
	Dispatcher option <b>"Layout has block detection hardware"</b> is not checked - 
	see <b><a href="Options.shtml">Dispatcher Options</a></b>. 
	</ul>
</li>
<li><p><b>Allocate Button</b> - Click this button to request immediate allocation 
of the Section to the requesting Active Train. If the Section is FREE, and if the 
Section occupancy is either UNOCCUPIED or UNKNOWN, the Section will be allocated 
to the requesting Active Train. If the Section is FREE, but the Section  
is OCCUPIED, the dispatcher is prompted to either override the occupancy or 
wait.</p>
<p>If the Section is ALLOCATED to another Active Train, the button click 
will be ignored. A Section may be allocated to only one Active Train at a time. 
If an ALLOCATED Section needs to be reallocated to a different Active Train, it 
must first be <b>released</b>. (See the 
<b><a href="AllocatedSections.shtml">Allocated Sections</a></b> window help file 
for instruction on <i>releasing</i> Allocated Sections.)</p>
<p> If "<i>Use connectivity ...</i>" is checked in the <b>Options</b> window, Dispatcher 
will check that turnouts are set correctly before actually allocating a Section. 
If turnouts are not set correctly, Dispatcher will attempt to set the turnouts if 
<b>Auto Set Turnouts</b> is checked in the <b>Options</b> menu (or checked in the 
<b>Options</b> window). If turnouts are not set correctly, the dispatcher is 
warned and given the option of overriding the turnout check and proceeding with  
allocation of the Section. For more information see 
<b><a href="Options.shtml">Dispatcher Options</a></b>.</p>
</li>
<li><p><b>Cancel Button</b> - Click this button to delete the Allocation 
Request without allocating the requested Section.
</li>
</ul>


<!--#include virtual="/Footer" -->
</body>
</html>
