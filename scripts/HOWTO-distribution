This is the HOWTO file to make a complete SourceForge downloadable
distribution.  ($Revision: 1.95 $)

Start with a directory, typically called "Distributions", that
contains "scripts" and "java" (from CVS) as subdirectories, and:

  scripts
  ln -s java/build.xml build.xml
  ln -s scripts/dist.xml dist.xml

  Linux
  	JMRI (can be empty)
  MacOSX
  	JMRI (can be empty)
  Windows
    JMRI (can be empty)
   
You also need to have installed (we use version 2.44):
    NSIS from http://nsis.sourceforge.net
    
Make sure everything is up-to-date:

( ) If it's a new year, update copyright dates (done for 2009):
    * build.xml (2) in the javadoc instructions
    * site/Copyright.html
    * decoder index master
    * (grep -r for the previous year in the web site, xml)
    
( ) Check if the decoder definitions have changed since the previous tag
    If so, remake the decoder index. 
        Delete old index from preferences
        Run program, remake index
        Make sure file is saved with Unix line ends.
        Diff w file in CVS tree as a check.
        Copy the new file from preferences into the CVS tree.
        Update the version number by hand, adding 2.
        Commit.
    
( ) Update the help/en/Acknowledgements.html help page with any recent changes

( ) Check for uncommitted changes in the web site directory, 
    these can end up in help, xml, etc

( ) Check if the help has changed since the previous tag
    If so, remake the help index  (need a command line approach, so can put in ant!)
    open ~/Documents/JMRI/JavaHelpStuff/jhelpdev/jhelpdev.jar
    (navigate to JHelpDev.xml in release & open it)
    (select properties from file menu, set directory to project help/en
    (click "generate all")
    
    In that same directory, also remake the index and toc web
    pages by doing invoking ant (no argument needed).
    
    Run the program and make sure help works.
    
    Commit any changed files.
    
( ) This is a good place to check that the JavaDocs generate without errors.
    If you fix anything, commit it back.

( ) This is a good place to check that the decoder XSLT transforms work
    If you fix anything, commit it back.

( ) The default.lcf file for releases is taken from Distribution/scripts/; 
    the one for normal development is from Distribution/java/.  Make sure
    the one in scripts/ is the one you want.
    
( ) Check that the Version.java file has been updated (both version
    number in two places and copyright date) and committed

( ) Edit the "manifest" file in your development directory, and make sure that the
    version number is correct in four places (this file comes from java/, not scripts/)
    
( ) Edit the version number into the top help page:
    bbedit help/en/index.html
    
( ) Update the MacOS X bundles version numbers:
    
    cd scripts
    bbedit MacOSXapps/V1/*.app/Contents/Info.plist
    (three versions, two copyright years)

    Commit back to CVS

( ) Update version number & copyright date in WinInstallFiles/InstallJMRI.nsi file
    
( ) Update version numbers in Window scripts

    bbedit *.bat
    
    Commit back to CVS

( ) Update version numbers in Linux scripts

    bbedit DecoderPro PanelPro cornwall JmriDemo LocoTools InstallTest

    Commit back to CVS

( ) Create the _next_ version-specific layout-config-2-5-*.dtd in xml/DTD
    and commit back to CVS; this needs to be a copy of the contents 
    of the file that's actually being released, so don't do it early!
    Update the comment at the top of the file (two places).
    Also, copy to the (pre-existing) next production DTD.
    
    Check proper value in java/src/jmri/configurexml/ConfigXmlManager.java (line 30)
    
    Update test/jmri/configurexml/LoadFileTest.xml
    
( ) To ensure that you've got the HEAD of CVS, in your test area do:

    cvs -q update -dA
    
    cd Distributions/scripts
    cvs -q update -dA
    
    cd Distributions/java
    cvs -q update -dA
    
------
Add something about copyright notices on changed files
------
    
To actually create the distribution:

( ) Go to your working directory and
	cvs -Q tag -F Release-2-7-1 

( ) Create a new working directory, if you haven't already:
    
    cd <project directory>
    mkdir X-Y-Z-cand
    cd X-Y-Z-cand
    cvs co -r Release-2-7-1 all
    
    This gives it a sticky tag.  If your working directory
    already has that name, just
    
    cvs -q update -r Release-2-7-1
    
    to make sure it's got the tag
    
( ) Come back to Distributions and 
    cd scripts
	cvs -Q tag -F Release-2-7-1
    cd ../java
	cvs -Q tag -F Release-2-7-1
    cd ..
    
( ) Announce the tag to jmri-developers list, wait for comments

( ) Start the actual build! In the Distributions directory:

	ant -f dist.xml -Drelease=Release-2-7-1 -Dnumber=2.7.1 release1
	
	Ensure tests pass
	
	Check DecoderPro for no startup errors, right version

    Ant will do the various builds, construct the distribution
    directories, and finally construct the Linux, MacOS X and Windows
    distribution files.
	
( ) The next few steps can be done in parallel.
		
** Consider making the files available for testing from the main site,
** and getting feedback from jmri-developers

** Consider testing Windows installer on a VM

( ) Upload the Linux, Mac OS X and Windows files

    ant -f dist.xml -Drelease=Release-2-7-1 -Dnumber=2.7.1 -Duser.name=jacobsen release2

    (The user.name only needs to be provided if your SourceForge.net ID 
     is different than your current login ID)
     
    --------------------------------------------
    Older methods (don't use if above succeeds):
    
    Finder: Connect to Server
    https://frs.sourceforge.net/j/ja/jacobsen/uploads
    
    Appears as /Volumes/uploads/
    
    Then do finder copies...
    
    Or:
    
    echo put JMRI.2.4.dmg | sftp jacobsen@frs.sf.net:uploads
    echo put JMRI.2.4.tgz | sftp jacobsen@frs.sf.net:uploads
    echo put JMRI.2.4.exe | sftp jacobsen@frs.sf.net:uploads


( ) Any time after release1 is complete, create and upload the JavaDocs
    and XSLT'd decoder pages
    
	ant -f dist.xml -Drelease=Release-2-7-1 -Dnumber=2.7.1 release3
	
	Manual form:
	rsync -n -avz --delete --rsh="ssh -l jacobsen" Release-2-7-1/java/doc jacobsen,jmri@web.sourceforge.net:htdocs/JavaDoc/doc
		
( ) Format the release note page, change date, etc

( ) Complete all the above before continuing

( ) Use sf-upload to create the SF.net release structures:  http://sf-upload.sourceforge.net/

    cd scripts

    For test release:
    bbedit notesfile*.txt changefile.txt
    sf-upload -g 26788 -packageid 49077 -r "JMRI 2.7.1 test version for Linux" -nf notesfileLin.txt  -cf changefile.txt -f JMRI.2.7.1.tgz -type ".gz" -noupload
    sf-upload -g 26788 -packageid 49077 -r "JMRI 2.7.1 test version for Mac OS X" -nf notesfileMac.txt  -cf changefile.txt -f JMRI.2.7.1.dmg -type ".dmg" -noupload
    sf-upload -g 26788 -packageid 49077 -r "JMRI 2.7.1 test version for Windows" -nf notesfileWin.txt  -cf changefile.txt -f JMRI.2.7.1.exe -type ".exe (32-bit Windows)" -noupload

    For production release:
    bbedit notesProdRel*.txt changefile.txt
    sf-upload -g 26788 -packageid 33771 -r "JMRI 2.7.1 production release for Linux" -nf notesProdRelLin.txt  -cf changefile.txt -f JMRI.2.7.1.tgz -type ".gz" -noupload
    sf-upload -g 26788 -packageid 33771 -r "JMRI 2.7.1 production release for Mac OS X" -nf notesProdRelMac.txt  -cf changefile.txt -f JMRI.2.7.1.dmg -type ".dmg" -noupload
    sf-upload -g 26788 -packageid 33771 -r "JMRI 2.7.1 production release for Windows" -nf notesProdRelWin.txt  -cf changefile.txt -f JMRI.2.7.1.exe -type ".exe (32-bit Windows)" -noupload

    (have to have a ~/.sfuploadrc file)
    
    --------------------------------------------
    Older methods (don't use if above succeeds):
 
    Login to SourceForge web using Firefox

	Go to the project home page, login, then admin page
	
	Click on Edit/Release Files  & release each of the three files
	in the order:
	
		Linux
		Mac OS X
		Windows
		
	The name convention is "JMRI 2.7.1 test version for Linux"
        or "JMRI 2.2 production release for Linux"
        
    The note says:

        The JMRI 2.7.1 test version is now available for download. 
        This is the specific version for Windows users. 
        For more information, please see the release note at http://jmri.sf.net/releasenotes/jmri2.7.1.shtml

    The change log says:
    
        The complete list of changes is in the release note at http://jmri.sf.net/releasenotes/jmri2.7.1.shtml

	Don't select "preserve preformatted text"
	
    --------------------------------------------

( ) Commit release note files to the web site CVS directory

( ) Wait until the downloads have propagated to the mirrors; check 
    by trying to download each file
    
( ) Ask JMRI-developers for a quick look _AND_ _WAIT_ _FOR_ _IT_!!

( ) Update the web site front page and downloads page
    		
( ) If the decoder definitions have changed, make a .zip file and send to:
    Graham Plowman: gppsoftware@gppsoftware.com

( ) Create the start of a release note for the next version

( ) Commit site
	
( ) File copyright registration

    https://eco.copyright.gov/eService_enu/   (Firefox only!)

( ) Wait for update on JMRI web server

( ) Mail announcement to jmriusers@yahoogroups.com
    Subject is "Test version 2.7.1 of JMRI/DecoderPro is available for download"

( ) Mail announcement to jmri-announce@lists.sourceforge.net

    You'll get a moderation message via email; handle it.

( ) News item from JMRI sourceforge page, Summary tab

	Title is of the form "JMRI 2.7.1 test version is available";
	text is pretty much directly taken from the release note

( ) If a production version, update the SF automatic download pages

( ) Decide if worth announcing elsewhere (production version or 
	big system-specific fix/feature):
	    RailRoadSoftware&yahoogroups.com
		MAC_DCC@yahoogroups.com
		loconet_hackers@yahoogroups.com
		digitrax@yahoogroups.com
		NCE-DCC@yahoogroups.com
		NCE-SYS1@yahoogroups.com
		easydcc@yahoogroups.com
		Model_TRAINS_DCC_Software@yahoogroups.com
		DigitalPlusbyLenz@yahoogroups.com
		linux-dcc@yahoogroups.com
		rrsoftware@yahoogroups.com
		Apple MacOS Software
		
( ) Consider submitting to SoftPedia
    http://mac.softpedia.com/user/submit.shtml

( ) Consider submitting to VersionTracker

( ) Commit back any changes made to this doc

( ) Take a break!

