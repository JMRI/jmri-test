This is the HOWTO file to make a complete SourceForge downloadable
distribution.  ($Revision: 1.61 $)

Start with a directory, typically called "Distributions", that
contains "scripts" and "java" (from CVS) as subdirectories, and:

  scripts
  ln -s java/build.xml build.xml
  ln -s scripts/dist.xml dist.xml

  Linux
  	JMRI (the most recent distribution)
  MacOSX
  	JMRI (the most recent distribution)

  (Windows is separate, and involves a shared disk with VPC, but
   basically all the necessary stuff is in a VPC directory)
   
This probably already exists. 

Make sure everything is up-to-date:

( ) Check if the decoder definitions have changed since the previous tag
    If so, remake the decoder index. 
    Copy the new file from preferences into the CVS tree.
    Update the version number by hand.
    Make sure file is saved with Unix line ends.
    Commit.
    
( ) Check if the help has changed since the previous tag
    If so, remake the help index  (need a command line approach, so can put in ant!)
    open ~/Documents/JMRI/JavaHelpStuff/jhelpdev/jhelpdev.jar
    (navigate to JHelpDev.xml in release & open it)
    (select properties from file menu, set directory to project help/en
    (click "generate all")
    
    Run the program and make sure help works.
    
( ) Update the help/en/Acknowledgements.html help page from the site community/index page

( ) the default.lcf file for releases is taken from Distribution/scripts/; 
    the one for normal development is from Distribution/java/.  Make sure
    the one in scripts/ is the one you want.
    
( ) Check that the Version.java file has been updated and committed

( ) Edit the "manifest" file in your development directory, and make sure that the
    version number is correct in four places (this file comes from java/, not scripts/)
    
( ) To ensure that you've got the HEAD of CVS, in your test area do:

    cvs -q update -dA
    
    cd Distributions/scripts
    cvs -q update -dA
    
    cd Distributions/java
    cvs -q update -dA
    
------
Add something about copyright notices on changed files
------
    
To actually create the distribution:

( ) Go to your working directory and
	cvs -q tag -F Release-X-Y-Z 

( ) Create a new working directory, if you haven't already:
    
    cd <project directory>
    mkdir X-Y-Z-cand
    cd X-Y-Z-cand
    cvs co -r Release-X-Y-Z all
    
    This gives it a sticky tag.  If your working directory
    already has that name, just
    
    cvs update -r Release-X-Y-Z
    
    to make sure it's got the tag
    
-----
Notes for next section:

* Clear out the Linux/JMRI directory, as it seems to have some
extra scripts.  Add to Ant?  Also, eventually check that the
Linux startup scripts have the executable permission bit set.
(2.0 had some work on this, follow up)

    
* NOTE THAT build.xml now creates a jar file with debug info by default;
change that (temporarily) for production versions

-----

( ) Come back to Distributions and 
    cd scripts
	cvs -q tag -F Release-X-Y-Z
    cd ../java
	cvs -q tag -F Release-X-Y-Z
    cd ..
    
( ) Update the MacOS X bundles:

    bbedit ../MacOSX/JMRI/*.app/Contents/Info.plist
    (three versions, two copyright years)
    bbedit ../MacOSX/JMRI/*.app/Contents/Resources/MRJApp.properties
    (Version number)

    Then check to make sure they still work.

( ) Start the actual build!  In the Distributions directory:

	ant -f dist.xml -Drelease=Release-1-2-3 -Dnumber=1.2.3 release1
	
	Ensure tests pass!
	
	Check DecoderPro for no startup errors, right version

    Ant will do the various builds, construct the distribution
    directories, and finally construct the Linux and MacOS X
    distribution files.
	
	The next few steps can be done in parallel.
	
( ) Upload the MacOS X and Linux files

	ant -f dist.xml -Drelease=Release-1-2-3 -Dnumber=1.2.3 release2

( ) Any time after release1 is complete, start building the Windows installer.
	
	Using VMware Fusion, make sure you have the Z disk available and that it
	contains the JMRI folder. (If not, check the "shared folders" and 
	"networking settings"; see Control menu)
	
	Launch Installer Vise from the last build file.
	Click "File" -> "Update archive"; Check changes make sense.
	Click the "test archive" button (right one of the pair)
	Name the installer JMRI.1.2.3.exe or so
	After the installer runs, run DecoderPro from desktop icon and check.
	In IV, "Save as..." the VCT file as the new name
	Drag-copy .exe to Mac, copy to final Distributions; name should be OK

    Alternate method:
    
    Mount PC.  Copy last .vct and Windows/JMRI to C:\WINDOWS\Desktop
    Create and test installer as above.  Copy the .exe back
    to the Distributions directory
    	
( ) Any time after release1 is complete, create and upload the XSLT pages. 
    
    cd Release-1-2-3/xml/XLST
    ant xslt
      (proceed only if no errors)
    ant upload
    cd ../../..

( ) Any time after release1 is complete, create and upload the JavaDocs
	ant -f dist.xml -Drelease=Release-1-2-3 -Dnumber=1.2.3 release3
	
( ) When ready to upload the Windows version:

	ant -f dist.xml -Drelease=Release-1-2-3 -Dnumber=1.2.3 release4
		
( ) Format the email announcement; you'll cut and paste parts
	to the release form.

( ) Login to SourceForge web using Firefox, not Safari (to use Quick Release)

	Go to the project home page, then admin page
	
	Click on Edit/Release Files  & release each of the three files
	in the order:
	
		Linux
		MacOS X
		Windows
		
	Be sure to update the top of the release note paragraph.
	
	The test release name convention is "JMRI 1.2.3 test version for Linux"
	
	Be sure to select "preserve preformatted text"
	
( ) Wait until the downloads have propagated to the mirrors; check 
    by trying to download each file
    
( ) Commit announcement file to the web site CVS directory

( ) Update the web site front page and downloads page
    		
( ) If the decoder definitions have changed, make a .zip file and send to:
    Hans Tanner:  hans.tanner@complexitymanager.com
    Graham Plowman: gppsoftware@gppsoftware.com

( ) Commit site and update on server
	
( ) Mail announcement to jmriusers@yahoogroups.com
    Subject is "Test version 1.2.3 of JMRI/DecoderPro is available for download"

( ) Mail announcement to jmri-announce@lists.sourceforge.net

    You'll get a moderation message via email; handle it.

( ) News item from JMRI sourceforge page

	Title is of the form "JMRI 1.2.3 is available"

( ) If a production version, update the SF automatic download pages

( ) Decide if worth announcing elsewhere (production version or 
	big system-specific fix/feature):
	    RailRoadSoftware&yahoogroups.com
		MAC_DCC@yahoogroups.com
		loconet_hackers@yahoogroups.com
		digitrax@yahoogroups.com
		NCE-DCC@yahoogroups.com
		NCE-SYS1@yahoogroups.com
		easydcc@yahoogroups.com
		Model_TRAINS_DCC_Software@yahoogroups.com
		DigitalPlusbyLenz@yahoogroups.com
		linux-dcc@yahoogroups.com
		rrsoftware@yahoogroups.com
		VersionTracker
		Apple MacOS Software
		
( ) Consider submitting to SoftPedia
    http://mac.softpedia.com/user/submit.shtml

( ) Consider submitting to VersionTracker

( ) Commit back any changes made to this doc

( ) Take a break!

=========================================

Old notes follow

	Note on using SF "Quick File Release" system:
		In Spring 2004, it would often give an error about "could not
		add file".  In that case, reupload the file, and edit the release
		to include the file (was a Safari problem; use IE)
		
		Alternately, use the Quick File Release system without selecting
		a file, then add it later.  This prevents the original uploads from
		being erased, so you don't have to upload them twice.

------------

( ) Create MacOS X DMG
   
   (this step is automatic in the release1 target, please ignore)
   
    rm temp.dmg
    hdiutil create -size 20MB -fs HFS+ -volname "JMRI 1.2.3" temp.dmg
    open temp.dmg
    (copy MacOSX/JMRI folder to DMG using finder)
    (cd /Volumes/JMRI(tab) ; ln -s /Applications .)
    ln -s /Applications .
    cd (back to Distributions)
    (eject)
    hdiutil convert temp.dmg -format UDZO -o JMRI.1.2.3.dmg

------------

( ) To manually upload:
    
    ftp upload.sf.net (userid ftp, pwd is email address)
    cd incoming
    bin
    put JMRI.1.2.3.dmg
    put JMRI.1.2.3.tgz
    exit

------------

To get ftp to work, needed to download two Apache jar
files and put in ~/.ant/lib/

ls -lt ~/.ant/lib
total 488
-rw-r--r--   1 jake  admin  180792 Nov  4 06:41 commons-net-1.4.1.jar
-rw-r--r--   1 jake  admin   65261 Nov  4 06:40 jakarta-oro-2.0.8.jar

